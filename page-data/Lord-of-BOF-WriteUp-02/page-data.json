{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-02/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/c4e93c828ba48a65e888ab36393de1fd/8512a/0.png","srcSet":"/static/c4e93c828ba48a65e888ab36393de1fd/a72a4/0.png 108w,\n/static/c4e93c828ba48a65e888ab36393de1fd/a6679/0.png 216w,\n/static/c4e93c828ba48a65e888ab36393de1fd/8512a/0.png 432w","sizes":"(min-width: 432px) 432px, 100vw"},"sources":[{"srcSet":"/static/c4e93c828ba48a65e888ab36393de1fd/c914c/0.webp 108w,\n/static/c4e93c828ba48a65e888ab36393de1fd/a0779/0.webp 216w,\n/static/c4e93c828ba48a65e888ab36393de1fd/dd357/0.webp 432w","type":"image/webp","sizes":"(min-width: 432px) 432px, 100vw"}]},"width":660,"height":400.27777777777777}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - cobolt\r\n        - small buffer\r\n*/</span>\r\n\r\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stack frame structure:</p>\n<p>| buffer[16] |\r\n| Stack Frame Pointer[4] |\r\n| Return Address[4] |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>이제 앞서 사용했던 직접 buffer에 삽입하는 방법은 사용할 수 없음을 알 수 있다. 쉘코드의 크기가 buffer의 크기를 넘어버리기 때문이다. 그렇기 때문에 argument를 활용하는 방식으로 권한 상승을 시도한다. gremlin의 경우처럼 디버깅을 가능하게 하기 위해 gremlin 소유의 디렉토리를 생성한 후 cobolt 실행파일을 복사한 후 디버깅을 진행한다. 다음은 gdb로 확인한 cobolt의 어셈블리어 코드이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 432px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c4e93c828ba48a65e888ab36393de1fd/0e0c3/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 129.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADO0lEQVR42oVU25KkKBAtQeUqJYhyTcDq2f3/T9xAa7tn+qGHJyOMEyfPJfORIKecnA85J3scKYVlkdporbXZjHoqQihjzFqr1PL49j7+/cd7Zzabcy4FAIBSKpeFC84YFYtcFsk550IopdAw/AFuHx+1QojR7rbUGqNnjBFKOGcxxVWv2ujzrFJKxhlCw/A7PtdaILsQ1FPFDM4dq9ZoeIzTFGJAaOBCtlb3fQfIGKE/mMt5ltKZjTFQawh+sxYNCGEMBRgjXMra6rbv59mcOzhnj8dj+ATXWlLO2/YGe+/necIY+xAwRkLK89ViSjEl3/+6RSkueAdDqzfzuq4x5+PYnXeEzAihmKIQnHF+frxSShmKlIJSyjkfx/EC1wqQfeje5FK8d9baC4xTTtM0cSFKAeedD15I8VRKLssbfI8dUzTblkt1zsWUCCG4ay7iCul8nf2Dc9Qf/jK8XuAMcGuO0fsQCJkHhDIAo/QGdyeCF4Ibowkhn1GVe2yt15DScew+hHmeEMa+R4WEkCnF63m5LMsiv6KC1gAghGiMhtq6nRczxmMugBDmQty6Si1C9vF7VPfo9fVqrWYAa7celXchxg4eRyhA5plS+vHrl1KLNnr5Vu9uWOs5G6Nz6TmnyzCEUMqZkFkIeb4+9Gb0ZpRS7tiFEHa3lNG35p6z7jk7dxzumOcZYRRS5IwxzmtrQghCKWNUSsE4u4vwKK1ByTElbUwu1fsjXJpRdzvT3932jnEmF7muT4zxFdXrHZW12wV2KWf6HjthjHkf+xVTqq0qpazdhBTGaErJA85WCmTo3Y4A3h+9JPPNDELwS/Or7ykh0zSRuXtJKO0l+7+e4flUCXo9Qwz3YuScpeSM8fY6U04ZQKnlrs044i+3fQjrukL91Exu5nmee85n9b6nwLthkguO8fiuZ2s1xKCNLq0FfzjvKCX3Vq16HYYBjyPCeBzH4dsN65ekr2RY12fM0FfSHXe3j2OfpvHxw+uaS3bePZ9PaP1WHMdOKemLkXrVfgLX19nOGkLQ/Qw17zvzDU5/BZe35tiZa/POOe+vsTGU/BcwtGZ3azYTY6zneRzW7ntKcRiGO+0fwP8B3m1e2ZcdYckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c4e93c828ba48a65e888ab36393de1fd/c9b55/0.webp 165w,\n/static/c4e93c828ba48a65e888ab36393de1fd/f2908/0.webp 330w,\n/static/c4e93c828ba48a65e888ab36393de1fd/0bafe/0.webp 432w\"\n              sizes=\"(max-width: 432px) 100vw, 432px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c4e93c828ba48a65e888ab36393de1fd/04c57/0.png 165w,\n/static/c4e93c828ba48a65e888ab36393de1fd/d9ecf/0.png 330w,\n/static/c4e93c828ba48a65e888ab36393de1fd/0e0c3/0.png 432w\"\n            sizes=\"(max-width: 432px) 100vw, 432px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c4e93c828ba48a65e888ab36393de1fd/0e0c3/0.png\"\n            alt=\"disas\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>앞과 동일하게 main+3에 breakpoint를 걸어준 후 두 개의 argument를 python으로 입력하여 buffer의 주소와 argv[2]의 주소를 찾도록 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 643px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72826d35699e8fbf11a0b0cdd703998f/b5bda/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.848484848484848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAxUlEQVR42lWOy66DMAwFHSfcEgIh5Imd+C74/4+soFKlntWszgwMkVxSrTWEfds2770xRilUiA8orbVSCn8HAL13GDJqLbUWYkopiUg7Wy75OA5i2sNeSo4xOudKyeHYc8nzPFtrr+sC72/b6/W3+W1dnffeLtYYo7UGAERUj/cr/wAAiAhw59ZqTCmEkFKy9xZr7TRN+AR/LvSXtTbTdGdzhy5j/EuMERGJqY/hnAOAdjbuvD580knMdlmUUsQ0RIwxRPQGcG0OX0OAmVwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/72826d35699e8fbf11a0b0cdd703998f/c9b55/1.webp 165w,\n/static/72826d35699e8fbf11a0b0cdd703998f/f2908/1.webp 330w,\n/static/72826d35699e8fbf11a0b0cdd703998f/b1337/1.webp 643w\"\n              sizes=\"(max-width: 643px) 100vw, 643px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/72826d35699e8fbf11a0b0cdd703998f/04c57/1.png 165w,\n/static/72826d35699e8fbf11a0b0cdd703998f/d9ecf/1.png 330w,\n/static/72826d35699e8fbf11a0b0cdd703998f/b5bda/1.png 643w\"\n            sizes=\"(max-width: 643px) 100vw, 643px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/72826d35699e8fbf11a0b0cdd703998f/b5bda/1.png\"\n            alt=\"argv addr1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>(중략)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 604px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fbb984ce8cd0363421309854f1aa1854/87254/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA60lEQVR42kXP227DIBAE0JGCHTW1iw0YdjGwXPL/31jF6WXej2YGfYzxHMQBQGCSKmc6AehtKyK55OlKEWm9aa0BEFPrjYiQck4lW2sA7MYws/cewLKuMUaOPE2TUoqIUk7rugJw7kgpWedwlsyR930HYKzhGH/wsjAzMU/zrJQKRPE8l2W5sIsxGmvRnkOqvEEgqq3+zZZWi8g839U0lSJtdL1tADjG1ltgQhuj9hbCG4d/rLXUKlXu9xfOJb8+/+I++gsHpsMfWn9dbdp7b60F8PF4uMM555RSt9vNOXcc7vOavZndB7/t+zdbhho1giBL/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fbb984ce8cd0363421309854f1aa1854/c9b55/2.webp 165w,\n/static/fbb984ce8cd0363421309854f1aa1854/f2908/2.webp 330w,\n/static/fbb984ce8cd0363421309854f1aa1854/059a8/2.webp 604w\"\n              sizes=\"(max-width: 604px) 100vw, 604px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fbb984ce8cd0363421309854f1aa1854/04c57/2.png 165w,\n/static/fbb984ce8cd0363421309854f1aa1854/d9ecf/2.png 330w,\n/static/fbb984ce8cd0363421309854f1aa1854/87254/2.png 604w\"\n            sizes=\"(max-width: 604px) 100vw, 604px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fbb984ce8cd0363421309854f1aa1854/87254/2.png\"\n            alt=\"argv addr2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>argv[2]의 시작 주소가 0xbffffc01인 것을 알 수 있다. 이제 원본 cobolt에서 gremlin의 경우와 같이 exploit을 진행한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 643px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/452997115c52cb255597e7a8928b077b/b5bda/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.424242424242426%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAzElEQVR42k3IXWuDMBTG8YAcjakS9Wh27EXSYrqLri+smYPOFarsogw06/f/MqPCYL+LPzwPQ8SiKJRSaZoiYlmWSlUFopQSEYlIPal6VqlqPksikjI7HI/s1Z3cm2vf25Nz3Wc3+nH6maa7H/3o7/72fesuH+fu3A/98DW41m1ftrv9bvO8ufZX1timsY02+sFoszbGmMc0erVe1ct6sRBCiDzPqCYpZRAEAMAY00YzIsryjPM4/MM5D8MQAKKZiOMoiuJ/TZIEAKy1v/liGvgxq0AMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/452997115c52cb255597e7a8928b077b/c9b55/3.webp 165w,\n/static/452997115c52cb255597e7a8928b077b/f2908/3.webp 330w,\n/static/452997115c52cb255597e7a8928b077b/b1337/3.webp 643w\"\n              sizes=\"(max-width: 643px) 100vw, 643px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/452997115c52cb255597e7a8928b077b/04c57/3.png 165w,\n/static/452997115c52cb255597e7a8928b077b/d9ecf/3.png 330w,\n/static/452997115c52cb255597e7a8928b077b/b5bda/3.png 643w\"\n            sizes=\"(max-width: 643px) 100vw, 643px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/452997115c52cb255597e7a8928b077b/b5bda/3.png\"\n            alt=\"argv addr2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 131px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/320d37d945e4b200ed9f89755220e3b2/658fe/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.87786259541985%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABN0lEQVR42m2Na0/CMBhG33Z0bAi6MBG3rtva3bq1uwBjgCh+Q+P//0GKMZgYz8fz5OSBpl+FYRhQLxaiKLJcSteZThw3L3L/cXF751DqhVHEAp8yJhJhmgSu9MeD0s3Qr3RTa101XetM7emC7o+7ukpty1r3XdN1Q78qVbXddOOx+RvfunMAQAhhjE1zjDEmxDQJQQZZLh/sycR157Zlwb+8nM/Pp9fjftOuNm8f77PZDQ15nnIwzN1+aNf9/jCwwAMAwzBGhoExRhghhC6xc+8CACGEjC6XPxYAfUuE8YiQq/xLN/QR54JHLGTrdROFLIi54HEiYgBgMc/yTNc6E5FHfVmVSZqkmYz4ZYWiVnmp2kb7vqdUmaVJLBJZlcO2A4C0kLVWx9NTowrKmK5VIaWUpR/Qr/gT4QEmEx8xfgQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/320d37d945e4b200ed9f89755220e3b2/40151/4.webp 131w\"\n              sizes=\"(max-width: 131px) 100vw, 131px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/320d37d945e4b200ed9f89755220e3b2/658fe/4.png 131w\"\n            sizes=\"(max-width: 131px) 100vw, 131px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/320d37d945e4b200ed9f89755220e3b2/658fe/4.png\"\n            alt=\"argv addr2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: hacking exposed</p>","categories":["writeup","pwnable"],"date":"February 05, 2016","description":"","id":"3fff3f40-679b-5be0-a6b2-281f2c6be589","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-02/","title":"LOB 2번 (gremlin -> cobolt)","readingTime":{"text":"2 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}