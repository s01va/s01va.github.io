{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/WAS-Clustering/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/034197db4e89663b65a70c958cc5a667/2990b/0.png","srcSet":"/static/034197db4e89663b65a70c958cc5a667/2b65a/0.png 142w,\n/static/034197db4e89663b65a70c958cc5a667/28e88/0.png 284w,\n/static/034197db4e89663b65a70c958cc5a667/2990b/0.png 568w","sizes":"(min-width: 568px) 568px, 100vw"},"sources":[{"srcSet":"/static/034197db4e89663b65a70c958cc5a667/43197/0.webp 142w,\n/static/034197db4e89663b65a70c958cc5a667/66ca8/0.webp 284w,\n/static/034197db4e89663b65a70c958cc5a667/313fd/0.webp 568w","type":"image/webp","sizes":"(min-width: 568px) 568px, 100vw"}]},"width":660,"height":399.71830985915494}}}},"body":"<h1>Clustering</h1>\n<h2>Session &#x26; Cookie &#x26; Clustering</h2>\n<p>http에서 session은 사용자 하나하나를 구분할 수 없고, 상태를 알 수도 없다.</p>\n<p>신원확인을 위해 cookie를 사용한다.</p>\n<p>WAS를 이중화를 해 놓는다면 아래와 같은 모양새가 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"mermaid\"><pre class=\"language-mermaid\"><code class=\"language-mermaid\"><span class=\"token keyword\">graph</span> LR<span class=\"token punctuation\">;</span>\r\n\tA<span class=\"token text string\">[User]</span> <span class=\"token arrow operator\">--></span> B<span class=\"token text string\">[WAS1]</span><span class=\"token punctuation\">;</span>\r\n\tA <span class=\"token arrow operator\">--></span> C<span class=\"token text string\">[WAS2]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>User는 WAS1에 붙어있다가 문제가 생기면 WAS2에 연결되게 되는데, 로그인 등을 한 상태라면 이 상태를 가지고 그대로 작업을 가능하게 해야 한다.</p>\n<p>이를 위해서 하는 것이 클러스터링이다.</p>\n<p>User가 WAS1에서 쿠키를 받고 작업을 하다가 WAS1과의 연결이 끊어지면 user가 WAS1의 쿠키정보를 그대로 들고 WAS2로 갔을 때 작업이 가능해야 한다.</p>\n<p>하지만 Weblogic의 경우, 위의 그림과 같은 상태일 때 계속해서 새로고침을 하면 Session ID나 쿠키값이 계속 달라지는 것을 볼 수 있다.</p>\n<p>이는 새로고침 할 때마다 서버가 User를 각기 다른 사람으로 인식하기 때문이다.</p>\n<p>이를 위해 Web server를 사이에 설치해 준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"mermaid\"><pre class=\"language-mermaid\"><code class=\"language-mermaid\"><span class=\"token keyword\">graph</span> LR<span class=\"token punctuation\">;</span>\r\nA<span class=\"token text string\">[User]</span> <span class=\"token arrow operator\">==></span> B<span class=\"token text string\">[Web server]</span><span class=\"token punctuation\">;</span>\r\nB <span class=\"token arrow operator\">--></span> C<span class=\"token text string\">[WAS1]</span><span class=\"token punctuation\">;</span>\r\nB <span class=\"token arrow operator\">--></span> D<span class=\"token text string\">[WAS2]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>User는 새로고침을 하더라도 Web server가 쿠키값을 보고 User를 한 사람으로 인식하고 적절한 WAS로 load balancing 시켜주게 된다.</p>\n<p>또한 WAS들은 계속 같은 Web Server에 연결되어 있기 때문에 새로고침 때문에 User를 다른 사람으로 인식할 일이 없다.</p>\n<h3>JEUS의 경우</h3>\n<p>JEUS6까지 Session server가 따로 존재했었다. 쿠키정보를 Session server에 저장해 두었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"mermaid\"><pre class=\"language-mermaid\"><code class=\"language-mermaid\"><span class=\"token keyword\">graph</span> LR<span class=\"token punctuation\">;</span>\r\nA<span class=\"token text string\">[User]</span> <span class=\"token arrow operator\">==></span> B<span class=\"token text string\">[Web server]</span><span class=\"token punctuation\">;</span>\r\nB <span class=\"token arrow operator\">--></span> C<span class=\"token text string\">[WAS1]</span><span class=\"token punctuation\">;</span>\r\nC <span class=\"token arrow operator\">--></span> D<span class=\"token text string\">[Session server]</span><span class=\"token punctuation\">;</span>\r\nB <span class=\"token arrow operator\">--></span> E<span class=\"token text string\">[WAS2]</span><span class=\"token punctuation\">;</span>\r\nE <span class=\"token arrow operator\">--></span> D<span class=\"token punctuation\">;</span></code></pre></div>\n<p>user와 session연결이 되었을 때마다 session server의 쿠키값을 확인하는 방식이었다.</p>\n<p>JEUS7에 와서는 Session server가 사라졌다. 분산처리하는 방식으로 바뀌었기 때문이다.</p>\n<p>각 WAS에 session server를 두고 공유하는 방식으로 바뀌었다.</p>\n<p>(모두 공유하지 않는다. MS 4개가 있으면, primary server는 하나의 서버만 backup server로 삼는다. 모두 공유하면 리소스 낭비이므로)</p>\n<div class=\"gatsby-highlight\" data-language=\"mermaid\"><pre class=\"language-mermaid\"><code class=\"language-mermaid\"><span class=\"token keyword\">graph</span> LR<span class=\"token punctuation\">;</span>\r\nA<span class=\"token text string\">[User]</span> <span class=\"token arrow operator\">==></span> B<span class=\"token text string\">[Web server]</span> <span class=\"token arrow operator\">--></span> C<span class=\"token text string\">[WAS1 :Session Server]</span><span class=\"token punctuation\">;</span>\r\nB <span class=\"token arrow operator\">--></span> D<span class=\"token text string\">[WAS2 :Session Server]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Primary / Secondary(==backup)</h3>\n<p>보통 User와 최초 연결되는 서버가 Primary, 나머지 이중화 서버가 Secondary가 된다.</p>\n<p>Client가 primary 서버과 failover 되었을 때</p>\n<p>WebLogic의 경우: secondary를 바로 primary로 삼고 작업을 진행</p>\n<p>JEUS의 경우: 가장 가까운, 가령 third server에 가서 primary에게 다시한번 연결요청을 한다. 그래도 연결요청이 실패하면 secondary와 연결한다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 568px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.0909090909091%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAChElEQVR42mVSaXOiQBDl//+PZI0aBAG5QRM88kWTVA6XXVETI+tyn2FgsLfQ1O6H7Xo1NdXv9XTX6yEA4HiECtcVrjE+Vg3q+ghpli/uHxaLh83brv5PcDwCABDpJ3Yj5MfIDQs/Rl6M3KgIkurg5y/ft0/LtfXuBEnpRU2+EURfSPKKcELUPNQEnKb4irquAf5l/jIAUB9rjGs/Lgk/LqsS3c3uNE3TVHU6mYzH4/l8vlmvi6IAAHu/Hw6HuqYbhjE2jNvb2/l87rlOnGEizKrPPJtOJhLPC9xAVxRNUTRZeXl+RggBwP7jQ5UkieclQdBVVZWkoaYd7J0blUSU4SxNZEHgGUbmeYFlRI5jSJKhqM1mczgcxuMx2W43xYOBwLICy5Kdztb6GWY1EaZVnqWaqvIsy7Ncv9cTBwOB4zrttu/7AGAYRq/blQWB6zMMTYs8z/b7b9t1kGAiTEsAwCd7sjS11uuzSXme73a77XZr2/Z5M47jvO92jRhjAHBD1HTGVWma5nK5fLi/n04m1sqyLOuXbZum+fj4aO/3y9dX0/yxWMxns5llNXySRI3bQVIVRT4xDI5hrlqtbxcXkiCOhkNFls9jz6ZTiuwNWK51edlutWRJuhmNfh9sLy6JJMdpmuiqqgiCLssix2mSxLOMwHGr1crzvJvRiL6+HiqqIojSgFclkaWot40VpJhwwjLPEpHn+yTJ0X2Goliaprrdka7HcQwAz09P3asrju5zNN2wFEV2OhtrFWU14cUIjjgK/cBzGvhu6DeXPI3PnwwVRei7fkOd4Dlh4KIij9KKcEPkhMhPsBtj7wQ3ak4nqmyvOPjoECA3xmfBWePG2AlREKM/+qPY2wXpOv4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/034197db4e89663b65a70c958cc5a667/c9b55/0.webp 165w,\n/static/034197db4e89663b65a70c958cc5a667/f2908/0.webp 330w,\n/static/034197db4e89663b65a70c958cc5a667/bebff/0.webp 568w\"\n              sizes=\"(max-width: 568px) 100vw, 568px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/034197db4e89663b65a70c958cc5a667/04c57/0.png 165w,\n/static/034197db4e89663b65a70c958cc5a667/d9ecf/0.png 330w,\n/static/034197db4e89663b65a70c958cc5a667/10e91/0.png 568w\"\n            sizes=\"(max-width: 568px) 100vw, 568px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/034197db4e89663b65a70c958cc5a667/10e91/0.png\"\n            alt=\"session server 관계\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h3>Failover</h3>\n<p>MS1에서 문제가 발생했을 때, MS2로 역할을 넘기면서 장애를 <strong>극복</strong></p>\n<h3>Failback</h3>\n<p>장애상황 이후, MS1이 MS2로부터 <strong>역할을 회복</strong></p>\n<h2>Rolling Restart</h2>\n<p>클러스터링 된 4개의 MS A, B, C, D</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 568px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.0909090909091%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACiUlEQVR42mVQaW/aQBT0//8diDSBgE/WJ4bEdmhSiUQkaUw4TGqg1PcZ1l57K0P6qavZ1Xua2fdGQ2CM6xqXqCpRhVBdNqiqGqdZPn18mk6frA+7+k9Q1xhjTKSfyI2gH0M3Ovox9JoCBklx8LNXc/P8tl79coKk8KJ/gugLSV4STgibQc2o+uSibm5d1XWFT+fEfVH1uakrhCo/LggvLsoCfp9MhspQURTjzjDujPuHe/PNhBBijHfb7UhVVXWk3d5qmq5p2mQycZw/cYaIMCs/82xiGCIAPMepsqzKsiJJL7NZURQY4+12q4iiCIAIeFVRFFEcyvLvne1GBRFlKEsTiecBw0gAAIYROI7p9xiKsizrcDjout67umo+DwY8y/Is2+90NqtFmFVEmJZ5lg5lBTAs4Fi63+cHA8Bxnasr3/cxxpqm9btdiec5mmZIUgCApeiPzTpIEBGmjbeqauJJs2y9Xp+zyfPctu3NZrPf709xYsd1bdvGGKMSYYzdEDabUVmYpmm+mY/TqaFrq9V6tVzud/v5fD6bzXa73c/X18X74sfDg6HrlrWZz9+jMPCTkgiS8njMdU3jaOby4qLdaomCcDMey5J8tn1nGP3ra34waLda39ptWZJG6uiw33pxSSQ5StOkiZHnVUkSOG4oCoBheI5bLpee592Mx1SvN5JlhRdEABRBYEnyw1oFKSKcsMizRACA7vU4imb6JEtRZLc7VtU4jjHGL8/P3ctLjqZZimJIkiWpXqdjrRZRVhFeDHGNotAPPKeB74Z+U+RpfE4RHo+h7/oNdYLnhIELj3mUloQbQieEfoLcGHknuFHzOlG5944HHx4C6MboLDhr3Bg5IQxi+BcmqNhnTIdkWwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/96e92ce046d4e70c6873d9ea455b51b3/c9b55/1.webp 165w,\n/static/96e92ce046d4e70c6873d9ea455b51b3/f2908/1.webp 330w,\n/static/96e92ce046d4e70c6873d9ea455b51b3/bebff/1.webp 568w\"\n              sizes=\"(max-width: 568px) 100vw, 568px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/96e92ce046d4e70c6873d9ea455b51b3/04c57/1.png 165w,\n/static/96e92ce046d4e70c6873d9ea455b51b3/d9ecf/1.png 330w,\n/static/96e92ce046d4e70c6873d9ea455b51b3/10e91/1.png 568w\"\n            sizes=\"(max-width: 568px) 100vw, 568px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/96e92ce046d4e70c6873d9ea455b51b3/10e91/1.png\"\n            alt=\"session server 관계2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>유저가 A에 연결되어 있는 상태. Primary server A, Secondary(backup) server C</p>\n<p>ABCD 차례차례 재기동시키면, 세션이 유지가 될까?</p>\n<ul>\n<li>원래는 세션이 유지되지 않는다</li>\n<li>JEUS의 경우, 세션에 연결되어 있는 사용자가 재기동 하는 중에 \"타이밍 좋게 세션을 다시 신청하지 않았다\"면, 세션은 끊어진다.\n<ul>\n<li>세션을 새로 만드는 트리거는 사용자이지(새로고침 등), 운영자가 단순 재기동하는 행위는 세션을 다시 만들지 않기 때문이다.</li>\n</ul>\n</li>\n<li>세션 유지가 되게끔 만든 JEUS의 기능: Failback\n<ul>\n<li>세션이 있던 A를 죽임 -> B로 failover -> B가 계속 A를 주시 -> A가 살아나면 B가 본인이 가지고 있는 모든 정보(세션, 쿠키정보 등)을 A로 밀어넣는다.</li>\n</ul>\n</li>\n</ul>\n<h2>Config</h2>\n<p>Jeus -> Servers -> [서버 선택] -> Engine -> Session Config\r\nShared에 체크\r\n고급 선택사항 -> Tracking Mode: Cookie에 체크\r\nSession Cookie -> Domain 설정하기</p>","categories":["misc","setting"],"date":"February 07, 2020","description":null,"id":"25af225a-b88e-511d-b085-067dd7a67fb6","keywords":["was","webserver","weblogic","jeus","middleware"],"slug":"/WAS-Clustering/","title":"WAS Clustering","readingTime":{"text":"6 min read"}},"listingPagePath":"/blog"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}