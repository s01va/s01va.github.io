{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-14/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/9397e179524d64df50cd4edd7404cfa4/3bb48/0.png","srcSet":"/static/9397e179524d64df50cd4edd7404cfa4/e4a37/0.png 121w,\n/static/9397e179524d64df50cd4edd7404cfa4/c55bc/0.png 242w,\n/static/9397e179524d64df50cd4edd7404cfa4/3bb48/0.png 483w","sizes":"(min-width: 483px) 483px, 100vw"},"sources":[{"srcSet":"/static/9397e179524d64df50cd4edd7404cfa4/0e0e7/0.webp 121w,\n/static/9397e179524d64df50cd4edd7404cfa4/4c605/0.webp 242w,\n/static/9397e179524d64df50cd4edd7404cfa4/11ab1/0.webp 483w","type":"image/webp","sizes":"(min-width: 483px) 483px, 100vw"}]},"width":660,"height":400.3726708074534}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - giant\r\n        - RTL2\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        FILE <span class=\"token operator\">*</span>fp<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>lib_addr<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>execve_offset<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>execve_addr<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>ret<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// gain address of execve</span>\r\n        fp <span class=\"token operator\">=</span> <span class=\"token function\">popen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/usr/bin/ldd /home/giant/assassin | /bin/grep libc | /bin/awk '{print $4}'\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">sscanf</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token string\">\"(%x)\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>lib_addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        fp <span class=\"token operator\">=</span> <span class=\"token function\">popen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/usr/bin/nm /lib/libc.so.6 | /bin/grep __execve | /bin/awk '{print $1}'\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">sscanf</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token string\">\"%x\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>execve_offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        execve_addr <span class=\"token operator\">=</span> lib_addr <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>execve_offset<span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// end</span>\r\n\r\n        <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ret<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">44</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ret <span class=\"token operator\">!=</span> execve_addr<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"You must use execve!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| buffer |\r\n| SFP |\r\n| RET |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>우선 길어진 소스코드 분석을 하자. argc가 2보다 작을 시 거르는 조건문과 argv[1]을 buffer로 복사하여 이를 사용하는 부분은 이전과 같다. argv[1]이 어떻게 처리되느냐를 중점적으로 보아야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token number\">24</span>         fp <span class=\"token operator\">=</span> <span class=\"token function\">popen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/usr/bin/ldd /home/giant/assassin | /bin/grep libc | /bin/awk '{print $4}'\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>24번째 줄이다. 명령어 ldd는 인자로 오는 프로그램이나 공유 라이브러리들이 요구하는 공유 라이브러리들을 출력해 준다.\r\n명령어 awk는 패턴 검색 및 처리 언어로, 위처럼 “... | /bin/awk ‘{print $4}’”라고 되어있으면 좌측에서 파이프로 넘어온 출력 중 네번째 필드값(주소값이 해당됨)만 출력한다.\r\n즉 바이너리 파일인 assassin의 공유 라이브러리 중 libc 공유 라이브러리를 찾아 그의 주소값을 fp에 저장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token number\">25</span>         <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token number\">26</span>         <span class=\"token function\">sscanf</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token string\">\"(%x)\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>lib_addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>24번째 줄에서 구한 assassin 파일이 의존하는 libc 공유라이브러리의 주소값을 buffer에 저장하고, 그 buffer를 16진수 형태로(%x) 포인터 execve_offset이 가리키는 곳에 저장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token number\">29</span>         fp <span class=\"token operator\">=</span> <span class=\"token function\">popen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/usr/bin/nm /lib/libc.so.6 | /bin/grep __execve | /bin/awk '{print $1}'\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>명령어 nm은 인자로 오는 오브젝트 파일에 포함된 심볼들을 리스트화 시켜 보여준다.\r\n/lib/libc.so.6에 포함된 심볼들을 리스트화 시킨 후 그 결과물 중에서 <code class=\"language-text\">__execve</code>가 포함된 것을 골라 그 첫번째 필드(주소값)를 fp에 저장하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token number\">30</span>         <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token number\">31</span>         <span class=\"token function\">sscanf</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token string\">\"%x\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>execve_offset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>30, 31번째 줄과 같은 동작을 하고 있다. libc의 execve함수의 주소를 execve_offset이 가리키는 곳에 저장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token number\">34</span>         execve_addr <span class=\"token operator\">=</span> lib_addr <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>execve_offset<span class=\"token punctuation\">;</span>\r\n<span class=\"token number\">35</span>         <span class=\"token comment\">// end</span>\r\n<span class=\"token number\">36</span> \r\n<span class=\"token number\">37</span>         <span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ret<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">44</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token number\">38</span>         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ret <span class=\"token operator\">!=</span> execve_addr<span class=\"token punctuation\">)</span>\r\n<span class=\"token number\">39</span>         <span class=\"token punctuation\">{</span>\r\n<span class=\"token number\">40</span>                 <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"You must use execve!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token number\">41</span>                 <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token number\">42</span>         <span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 483px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.03030303030303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+UlEQVR42o2Qy27CMBQFCVJ83w/bSXFI+P/frALtDqrOwrvRPePLvt+XZRljrOtaM0SkL83DPRwRAKn1JsyXt+zH/Ta+xtgej8PMEZGI3N3MmCkzI3yapvfy2MbYhrshkQgDADMTMTPP81wKqOo8zx8vL+t6PI5aU1WQMMJFTwBKAYgIRPgk763VzHwNfu5MU7v8hzFuz79Bc2PmAsXMVNXdiElU6cwREX5Tjoiq+npFhZgz85TDRURNEYGYReT6K09Pfpp7r703ETGziDA3RDyzTUspf81299rqNkZrPTPNDaCISNYqIh7BzKJaW81a3f16ncw8IwrAN/LJEvXfLs1dAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9397e179524d64df50cd4edd7404cfa4/c9b55/0.webp 165w,\n/static/9397e179524d64df50cd4edd7404cfa4/f2908/0.webp 330w,\n/static/9397e179524d64df50cd4edd7404cfa4/30f41/0.webp 483w\"\n              sizes=\"(max-width: 483px) 100vw, 483px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9397e179524d64df50cd4edd7404cfa4/04c57/0.png 165w,\n/static/9397e179524d64df50cd4edd7404cfa4/d9ecf/0.png 330w,\n/static/9397e179524d64df50cd4edd7404cfa4/77a9e/0.png 483w\"\n            sizes=\"(max-width: 483px) 100vw, 483px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9397e179524d64df50cd4edd7404cfa4/77a9e/0.png\"\n            alt=\"p_execve\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.2727272727272725%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAOElEQVR42k3IMQ7AMAgDwEq4YMhkMTRDw/+f2bU33nXOu/cjqbslrVUk3Z1kRGSmmf0HQFXhxsx8YUQCwNux3owAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7be6d40a8f43e0a32a8920b95a3d1d7c/c9b55/1.webp 165w,\n/static/7be6d40a8f43e0a32a8920b95a3d1d7c/f2908/1.webp 330w,\n/static/7be6d40a8f43e0a32a8920b95a3d1d7c/ff4b8/1.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7be6d40a8f43e0a32a8920b95a3d1d7c/04c57/1.png 165w,\n/static/7be6d40a8f43e0a32a8920b95a3d1d7c/d9ecf/1.png 330w,\n/static/7be6d40a8f43e0a32a8920b95a3d1d7c/32056/1.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7be6d40a8f43e0a32a8920b95a3d1d7c/32056/1.png\"\n            alt=\"exploit_test\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>여기서 주의해야 할 점이 있다. bash2에 \\0a를 \\00으로 인식하는 오류가 있어 위와 같이 입력하면 \\x9d까지를 인자로 인식한다. <code class=\"language-text\">~~~</code> 부분을 아래와 같이 “”로 감싸주어야 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.121212121212121%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAASElEQVR42o3JsQ3AMAgEQBAQ/okUi8LuvP+akZwFcu3JWmuMB8B1VDEzIwJARJBw96/yMDMSZrb3lu6uuwCAdHf5QVVFZM75AtwlAtwRJBNZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/90b69cadae438da2bfbf63d374d2106a/c9b55/2.webp 165w,\n/static/90b69cadae438da2bfbf63d374d2106a/f2908/2.webp 330w,\n/static/90b69cadae438da2bfbf63d374d2106a/ff4b8/2.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/90b69cadae438da2bfbf63d374d2106a/04c57/2.png 165w,\n/static/90b69cadae438da2bfbf63d374d2106a/d9ecf/2.png 330w,\n/static/90b69cadae438da2bfbf63d374d2106a/32056/2.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/90b69cadae438da2bfbf63d374d2106a/32056/2.png\"\n            alt=\"exploit_test2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>“You must use execve!”가 뜨지 않는 것을 보아 무사히 execve의 주소값이 입력이 된 것을 알 수 있다.\r\nexecve 함수는 세 가지 인자를 갖는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token keyword\">int</span> <span class=\"token function\">execve</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token keyword\">const</span> argv <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token keyword\">const</span> envp<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>/bin/sh을 실행시키기 위해서 아래와 같이 인자가 들어가야 할 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\r\n<span class=\"token function\">execve</span><span class=\"token punctuation\">(</span>“<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>sh”<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>“<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>sh”<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>문제는 execve의 두번째 인자값으로 오는 {“/bin/sh”, NULL}을 어떻게 처리하느냐이다. 이를 확인하기 위해 다음과 같은 프로그램을 작성하고 이를 gdb로 확인해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 394px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.30303030303031%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWUlEQVR42p2SUW/rIAyFE7AdbJKQJkAIIa00aa/7/z9vYtWqruu2q3ueMJJ95M+nOV6Py/lSSklbyjnnfV9j6Pu+lH0YehEZhjHG6IMfnSPE5l4vby855XKUvh9KKTlvIXgWab6pbdvHL2utYSMsgMjM1goL44PDT3LT5Jyb59m58TTPImytXfwyuvGJ1YNCCMuypLR6750bQYMxnTEGCYnIMLMIMyulkMhaK7U0APBldIhrCH7xy+Vy2N4i0TRNKVWKW946QjdN53PZy75tq4g8NMdy7HvJIfim/aeVmxsbAOy6DgC01veEr3paNgigARBBKaW1Vq1SqgWs+pNXczqdrrRjDHnPzo3e+21Lzjml2g+3zyPX1w/zfKXlRSpdIkJEw2y67jfn2xpIxFzjMQxDXNc1rSmtMca+ryENoWaW2TwP3Y0cIhDRlRx8SGtdL490z/JLz3/oHVbXFkq8LydRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b019a4fe86513618f2d87381a7625006/c9b55/3.webp 165w,\n/static/b019a4fe86513618f2d87381a7625006/f2908/3.webp 330w,\n/static/b019a4fe86513618f2d87381a7625006/47f09/3.webp 394w\"\n              sizes=\"(max-width: 394px) 100vw, 394px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b019a4fe86513618f2d87381a7625006/04c57/3.png 165w,\n/static/b019a4fe86513618f2d87381a7625006/d9ecf/3.png 330w,\n/static/b019a4fe86513618f2d87381a7625006/cc097/3.png 394w\"\n            sizes=\"(max-width: 394px) 100vw, 394px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b019a4fe86513618f2d87381a7625006/cc097/3.png\"\n            alt=\"testargv.c\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 475px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB0ElEQVR42mVS2Y7kIBCDdBLCGcJNcWVm/v8fV3T37rS0fkPC5bLLKARfak05h+BD8NYaY01K0XunlKKUPp/JOiel5JxTSpcFoxfG150hhRj7Pfro13UxxoQQbIJyxgghSikhBPofpdWUo7E2xAAFhBCUUsaYsUbr01nrnaVzxI4xxgt+4U2urfUxMoBxdtzDWrtvG8ZLbXXf91Pr++4pRaXkp+SbnwGm55QuYzJk5zzZd4SQ825dVyllbbX3HmMQUnBG52rH8U+5llonLfhxDx/CcRCMlwyZcSaVGvd4foDa6vfPz/j+KrX03qTgKEOurYUQ9HUBgI9BcIYx9t7vhAghWmu1tVILFMg5l1a9d9YaehBUa62txhitd2OMmJIUAmMMAJzz8zxba1xwchAhJWd0feK9NhSorWXIxhoAiDEKzhFCIcbjoFJJgJxymjdn9Pjr9h1YqeUZWLTOtd6mshQI4ZTiuq6nPvvorXdrzLIs275t2/Yb+ks55Zk2FAgxvvoQU5RSEkL0dWmtKaVSqlMpxthHSWqprcU0e9J6m2Q5PYcQGGMYoXVdH0/8Wv0gzyPHFHOZB3B+1vuxLFLKx+NxHERrfZ4n51xrvSzLJ/kPhVUtlWsN7LIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c054dbf251db188b67a73b2b6d9c4746/c9b55/4.webp 165w,\n/static/c054dbf251db188b67a73b2b6d9c4746/f2908/4.webp 330w,\n/static/c054dbf251db188b67a73b2b6d9c4746/4287c/4.webp 475w\"\n              sizes=\"(max-width: 475px) 100vw, 475px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c054dbf251db188b67a73b2b6d9c4746/04c57/4.png 165w,\n/static/c054dbf251db188b67a73b2b6d9c4746/d9ecf/4.png 330w,\n/static/c054dbf251db188b67a73b2b6d9c4746/466da/4.png 475w\"\n            sizes=\"(max-width: 475px) 100vw, 475px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c054dbf251db188b67a73b2b6d9c4746/466da/4.png\"\n            alt=\"gdb\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>보통 함수가 실행되기 직전에 인자를 eax로 받으므로 bp를 0x80483eb에 걸고 이 때의 eax를 조사해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 379px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.84848484848484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB/ElEQVR42pVS227dIBD0BQwGlosxd7B9EilqpPQz+v+/VNknTROlStsRD2OLWWZnt8ul5JIlCK1Vyjnl1Fpb7YIQJoQghPp36Lr+w2dpbd+34J1SCk8T45xzZlerjXHecc66L9D2rbWqtaaUMsa4EIwxhNCdCMFBAr8AABjjiwouOMa4O+9zBgCcM6WkMUYphRDSWiulpJTaaJASQJjFYISkVFprs2hCSLdYu67WaC0l4GnCGC/LYoxZrJUSKKUC4O4LjeMn29t+ux0pxRSD8z6nRMiEJzxfIIRM00TIhNA4nuKPgdXW2tZ8CDF6AEAIAYhcsnPOrqtZzFeB1a3VVmMMp3mz1FrPeZUipZznGQDmee66bpqmizMhzl5exbmUlKJzznknQJaS83lKTPFMUXBKSdf1hBIAIITOM6OEvvW8bVuLl54LkXOOIaSc7BnYmSzn/N6htTaklHL2wY/DcIpLa7WV43azq51nFlOKIcSUnFtLbbkWH/xM6TCix8eHb8/PL99fHh4f0HiJa6ul5v04vFsZY+FCKmf5GJMP/ixKad8Pzq12teL9zp2B1bIfe4p+uMz0fS+lvAbT/VrpV7znV2C1lpK3Yw/eDf1w/6mUuhf6C8rd9r6nFN4EWuvx8z79SXzO+Xg6Uv4tllL+08ux5LRG9GNEHnf/iZ84GC0/aXFaVQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/184322a79ebd5e7ba0725eaeb62c0dc9/c9b55/5.webp 165w,\n/static/184322a79ebd5e7ba0725eaeb62c0dc9/f2908/5.webp 330w,\n/static/184322a79ebd5e7ba0725eaeb62c0dc9/8a4f3/5.webp 379w\"\n              sizes=\"(max-width: 379px) 100vw, 379px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/184322a79ebd5e7ba0725eaeb62c0dc9/04c57/5.png 165w,\n/static/184322a79ebd5e7ba0725eaeb62c0dc9/d9ecf/5.png 330w,\n/static/184322a79ebd5e7ba0725eaeb62c0dc9/811d1/5.png 379w\"\n            sizes=\"(max-width: 379px) 100vw, 379px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/184322a79ebd5e7ba0725eaeb62c0dc9/811d1/5.png\"\n            alt=\"memory\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>eax는 0xbffffb00이라는 주소지를 담고 있으며, 이 주소지는 다시 0x80484a0이라는 주소지를 담고 있고, 0x80484a0으로 가야 비로소 문자열들을 발견할 수 있다. 이번에는 tmp[1]의 “BBBBBBBB” 대신 NULL을 넣고 위의 과정을 반복해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 339px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.60606060606061%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABo0lEQVR42pWSCY7cIBBFMWuBweBmq3K3nY4UzcVy/ztEtCezSZmZPCGrZBl98z5s2+j4sV9vt+vtRoTYEYk2Ij/PSLhdyT9IKSJi77315r2fpokxxu73OxLux15bCyHsx9E71lpDCIyx549OHvO7N623dV1LrTEl51wpOecc1xSCZ1+iHmitjdFaK7AglTRGO+eMMVLKaWJv1zuu16313nD8eb5cOqJzDgBow5QiAHyWnFJ0zuVSUkqtVW20Usr72RgjhNBaxzXFNFZaVwAAa9O6WgDOOXtxoLW+/7znfCklPz39WtekByaXQtuGREgEAPPsay3L4rngp8bx0Ebf9tHWthFSF0J8S9g5cMFHocGDBa31SyXTG86kV23fSvi3sLTEtMSllBxCqK262Xk/I/UYh8vPNgOAAVBKLctChDlfvPcxLqXm0fvfQ32BMWbbaDQ3O2stADjnrHMxJWvtx+vxgWma5GBELUtA7ERUW9v3veM4AgAcx55zTilJJc9Exh6FPXbKF4tKKSkk51xwLuUYOOfnFRJCPps3vzWrr5X8l+0/QnYdM4ZX/GcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/55b95ca7fc71792df37a7c69fe6b3142/c9b55/6.webp 165w,\n/static/55b95ca7fc71792df37a7c69fe6b3142/f2908/6.webp 330w,\n/static/55b95ca7fc71792df37a7c69fe6b3142/d6e88/6.webp 339w\"\n              sizes=\"(max-width: 339px) 100vw, 339px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/55b95ca7fc71792df37a7c69fe6b3142/04c57/6.png 165w,\n/static/55b95ca7fc71792df37a7c69fe6b3142/d9ecf/6.png 330w,\n/static/55b95ca7fc71792df37a7c69fe6b3142/16caa/6.png 339w\"\n            sizes=\"(max-width: 339px) 100vw, 339px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/55b95ca7fc71792df37a7c69fe6b3142/16caa/6.png\"\n            alt=\"testargv.c_2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 418px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.545454545454545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAbklEQVR42pXFMQ7DIAwAQGikUAUZAyYmAkOA/z8yQ5auveVUqUVald5FaimlNaEY83WNcXt06UwAwDkzc+LT2oOIKCUi+hqjxpxrrTGn9+gQvUdrD4cYQti2DwAgYoxk9l390G+99yYCAFpr9acHbggIvH7qoIoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/08b16a0533e208a4e3cdc95fa329e8ed/c9b55/7.webp 165w,\n/static/08b16a0533e208a4e3cdc95fa329e8ed/f2908/7.webp 330w,\n/static/08b16a0533e208a4e3cdc95fa329e8ed/cd572/7.webp 418w\"\n              sizes=\"(max-width: 418px) 100vw, 418px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/08b16a0533e208a4e3cdc95fa329e8ed/04c57/7.png 165w,\n/static/08b16a0533e208a4e3cdc95fa329e8ed/d9ecf/7.png 330w,\n/static/08b16a0533e208a4e3cdc95fa329e8ed/d7398/7.png 418w\"\n            sizes=\"(max-width: 418px) 100vw, 418px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/08b16a0533e208a4e3cdc95fa329e8ed/d7398/7.png\"\n            alt=\"testargv\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 376px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.12121212121212%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABvklEQVR42n2S2ZLjIAxFvQSwWYRBgFmEne7//8gpJzNTSVdmzgMPKt3SvUJDrvW8HyFgSqm21qgdR7cWwFq7WWO0854LscpVKbltm0PcLAxP+nmc5xEDBsSY4p5zraXWYoxx3islh//QOh33A71TUs7zzC+YUkppDQDrurw2j+P4Jn4MyoheG+W8Q0TvPbsx5zZ7ubQxRue9c3bf0yKEcy6EEGJQSg1cCMHFui7LIjhnnHOppOBcPViWRUqplGacCcGnabrd2MMdn+d5qES9076nGIMBMGBiDN47DNFtVkoJ1oYYpZScsQ+Zz/tZSo4xOOcR/W2eueBcCKW0lOvfnOMLf8RE1JtHpNYArFISQzjvZyXatg0A3rp/0HunTqWUEIOUqrWWS077jugBwG6bMWaapmEYEXEvubZWamG329P2Jb5/f8UY1nXNFzv1vu/X24hijErKYRhrrdR7SpEL8dtL60Sd+nHsOTPG5gfOOcHFj5Af/DeiRvX8uueS53l6FrXW1098Ynw9ldIa9ZZSyjlro6+QAN77f4nfF3aex3mUUmKKxhgiqrU2alprsPaxcMOvCxEYvAFARADzFP8CG/cn5DL79/UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1ad885f48db8be4acad586136ce3fec4/c9b55/8.webp 165w,\n/static/1ad885f48db8be4acad586136ce3fec4/f2908/8.webp 330w,\n/static/1ad885f48db8be4acad586136ce3fec4/f1608/8.webp 376w\"\n              sizes=\"(max-width: 376px) 100vw, 376px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1ad885f48db8be4acad586136ce3fec4/04c57/8.png 165w,\n/static/1ad885f48db8be4acad586136ce3fec4/d9ecf/8.png 330w,\n/static/1ad885f48db8be4acad586136ce3fec4/d38a6/8.png 376w\"\n            sizes=\"(max-width: 376px) 100vw, 376px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1ad885f48db8be4acad586136ce3fec4/d38a6/8.png\"\n            alt=\"memory2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>gdb에서 0x80484a8자리가 null이기 때문에 gdb에서는 문자열로 잡지 못하나, 위에서 프로그램을 실행시켰을 시 null이라고 뜨는 것을 보아 프로그램은 null을 분명히 인식하는 것을 알 수 있다. 쉘코드를 환경변수로 준 후, 주소지를 확인해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 413px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.121212121212121%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAYklEQVR42jXIQQ4DIQgAQA91AYmbJgVFlNX/v7LpoXOcZD7W8hUxl/fe53SRj6jss993jSdaU9G2z4mIZ28zY+a7ViJKNob7UFVEQEQiuq4MAMyc84uoIGL+DXIpSAQA6e8LU5sHjqAQUBYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e5a95408665a433149a123ab53dcfc96/c9b55/9.webp 165w,\n/static/e5a95408665a433149a123ab53dcfc96/f2908/9.webp 330w,\n/static/e5a95408665a433149a123ab53dcfc96/f2c1b/9.webp 413w\"\n              sizes=\"(max-width: 413px) 100vw, 413px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e5a95408665a433149a123ab53dcfc96/04c57/9.png 165w,\n/static/e5a95408665a433149a123ab53dcfc96/d9ecf/9.png 330w,\n/static/e5a95408665a433149a123ab53dcfc96/6c1e7/9.png 413w\"\n            sizes=\"(max-width: 413px) 100vw, 413px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e5a95408665a433149a123ab53dcfc96/6c1e7/9.png\"\n            alt=\"printenv\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.84848484848484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABdklEQVR42oVS7Y7jIAx0gLIhfNlAEghJttuk2n3/JzylOZ10p7Y3shA/GGbGNnzdbvNcl3WJMXr0MUVjjJRSa911HTxD0zQAYK2F69c19VFr3arWGOOck1Iyxh/FOOfvyERkrOk6ZYzpdGeN9d4757Q5lFul3pGnOuU8eu+JqNbqne8eEEI0jB3VNOz3+efCAMA5B2UqOWci0loTkfcOEUMgZy0dQGsNhUCBKFDqExKGEJyzy7pCnesw9Eopxvipjx4R8TDvfUwJ0csPKaXknAshpJRCCIAjL+z3fbvvKUYAmGq93/d5mWutn9drP/Th4ehl5m3fbtt2fANQpmnbbvMyTweKtbZtW631GfIlGREBYBzz98/3vMwhhMvlco7qNPmcvKzLvCyInjHWD0Mp5RiUc+rZkP4lr59rKSWlRIRjzojYqlYIca5H08Dj5Uvldcw5puS9DyFwzhv4D/5az6lOKSXnXN/3iEd7tdHGGK07pdSbhv0C3ywfwp8OMT8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c3a744b4df002f3ff863caa3dcd23bad/c9b55/10.webp 165w,\n/static/c3a744b4df002f3ff863caa3dcd23bad/f2908/10.webp 330w,\n/static/c3a744b4df002f3ff863caa3dcd23bad/ff4b8/10.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c3a744b4df002f3ff863caa3dcd23bad/04c57/10.png 165w,\n/static/c3a744b4df002f3ff863caa3dcd23bad/d9ecf/10.png 330w,\n/static/c3a744b4df002f3ff863caa3dcd23bad/32056/10.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c3a744b4df002f3ff863caa3dcd23bad/32056/10.png\"\n            alt=\"memory3\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>“/bin/sh”이라는 문자열이 막 끝나는 지점인 0xbffffef6이 NULL인 것을 볼 수 있다. 이제 execve함수의 두번째 인자({“/bin/sh”, NULL})의 NULL은 따로 주지 않아도 되며, “/bin/sh”을 담고 있는 주소지인 0xbffffeef를 가리키는 주소지를 따로 만들어서 이를 execve함수의 두번째 인자로 넘겨주면 된다는 결론을 내릴 수 있다.\r\n하지만 여기에는 한가지 문제가 있다. 이전의 문제에서 확인했듯 우리는 예측했던 주소지를 넣고 공격을 시도했을 시, 종종 예상했던 주소지가 맞지 않았던 경험을 하였다. 만약 “/bin/sh”의 문자열을 어딘가에 넣고, 그 주소지를 가리키는 또다른 환경변수 등을 지정했을 시, 예상했던 “/bin/sh”이 미묘하게 다른 곳에 있을 수도 있고, 여기에 맞추어 “/bin/sh”의 주소지를 가리키던 환경변수까지 바꾸어 주어야 할 것이다. 브루트 포스 코드를 짜서 공격하는 방법도 있겠지만, 조금 더 실패할 가능성이 적은 쉬운 아이디어를 떠올렸다.</p>\n<p>| NULL |\r\n| “/bin/sh” |\r\n| exit |\r\n| system |\r\n| execve |</p>\n<p>execve를 호출하자마자 exit함수를 인자로 넣어 종료시킨 후, 바로 system함수를 호출하여 이전의 darkknight문제를 풀었듯 system으로 하여금 “/bin/sh”을 실행시키게 하는 방법이다.\r\n이미 구한 execve함수의 주소(0x400a9d48), 이전 문제에서 찾은 system 함수의 주소(0x40058ae0), system 함수 내에 존재하는 “/bin/sh” 문자열의 주소(0x400fbff9), 메모리에 끝자락에 항상 NULL로 존재하는 주소지(0xbffffffc) 등을 알고 있다. exit함수의 주소를 찾았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 366px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.78787878787879%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVR42nWQ246DMAxEQ5uLEzuxEwikQCn0/z9yRbuVVpV2HizLM+fBo5Z12Y+ttbau8zhN7dbaNKYUJct6X+o49X1JiZdlds7mUqbbjRMhkjFabfs+L7NwKqXcty1n0frqwAEAIgJA13VKqe6jy+XyXpRSarnfH4+t1kGEjTFIFIIvpUjOpe+Z+ZX6R4/jWNdZRAAcIiIhRdLXawgBEUMIKRHF6L134M4jodbXXzicCR9jxOATJ8nCwlprIso5p0g5C7MgonMuscjpfuDI/LITERpjtNH8ukguIsl7D96ziA8BwHVfP+zP53HsfcnTOE7T+K4K/DkcgLXWGksxWmu11t/wUCsR5iytNRYZ3s1ZW8c61GGote+LAxhO9Vrrv/APwZoVysl63lYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fd3a914e873e15bf4a91cc6d0ebc48b8/c9b55/11.webp 165w,\n/static/fd3a914e873e15bf4a91cc6d0ebc48b8/f2908/11.webp 330w,\n/static/fd3a914e873e15bf4a91cc6d0ebc48b8/4146f/11.webp 366w\"\n              sizes=\"(max-width: 366px) 100vw, 366px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fd3a914e873e15bf4a91cc6d0ebc48b8/04c57/11.png 165w,\n/static/fd3a914e873e15bf4a91cc6d0ebc48b8/d9ecf/11.png 330w,\n/static/fd3a914e873e15bf4a91cc6d0ebc48b8/8b153/11.png 366w\"\n            sizes=\"(max-width: 366px) 100vw, 366px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fd3a914e873e15bf4a91cc6d0ebc48b8/8b153/11.png\"\n            alt=\"p_exit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>exit 함수의 주소는 0x40039130이다. 이 정보들을 취합하여 공격을 시도하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.272727272727277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAnUlEQVR42pXOwQ6DIAwGYCQptIiIlhaXIYlX3/8BF/Ww6/afvuZvmpq979trE5Faayml1ppzjjGq6rIuorIseRxHLqwqIpJzTinNeT7P08QYEREAhmEwv+XZFBHDzNOUvPfgwDmHd64R4IZz7iouu9sARGStba2Z4zhWXpk5hOC9R8QQAgV6TEjPLaKvYxyttb1309pbVUspiPjv2x/33AsrJwuktgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4644b3af8bf66f8b4720b50bad03c885/c9b55/12.webp 165w,\n/static/4644b3af8bf66f8b4720b50bad03c885/f2908/12.webp 330w,\n/static/4644b3af8bf66f8b4720b50bad03c885/ff4b8/12.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4644b3af8bf66f8b4720b50bad03c885/04c57/12.png 165w,\n/static/4644b3af8bf66f8b4720b50bad03c885/d9ecf/12.png 330w,\n/static/4644b3af8bf66f8b4720b50bad03c885/32056/12.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4644b3af8bf66f8b4720b50bad03c885/32056/12.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>my-pass: one step closer</p>","categories":["writeup","wargame","pwnable"],"date":"February 05, 2016","description":"","id":"fc87df92-0aca-57db-9ff5-06b63e3002e0","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-14/","title":"LOB 14번 (bugbear -> giant)","readingTime":{"text":"8 min read"}},"listingPagePath":"/blog"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}