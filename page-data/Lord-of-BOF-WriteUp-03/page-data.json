{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-03/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/614058780ef653f69e69187ded16316d/92689/0.png","srcSet":"/static/614058780ef653f69e69187ded16316d/89005/0.png 119w,\n/static/614058780ef653f69e69187ded16316d/54264/0.png 238w,\n/static/614058780ef653f69e69187ded16316d/92689/0.png 476w","sizes":"(min-width: 476px) 476px, 100vw"},"sources":[{"srcSet":"/static/614058780ef653f69e69187ded16316d/91c48/0.webp 119w,\n/static/614058780ef653f69e69187ded16316d/918cd/0.webp 238w,\n/static/614058780ef653f69e69187ded16316d/f753e/0.webp 476w","type":"image/webp","sizes":"(min-width: 476px) 476px, 100vw"}]},"width":660,"height":399.327731092437}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">﻿<span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - goblin\r\n        - small buffer + stdin\r\n*/</span>\r\n\r\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">gets</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| buffer[16] |\r\n| Stack Frame Pointer[4] |\r\n| Return Address[4] |\r\n| argc |\r\n| argv |\r\n| eviron |</p>\n<p>이전과는 다르게 strcpy 함수가 아닌 gets함수를 사용하였다. gets 함수는 프로그램이 실행된 이후에 입력값을 받기 시작하기 때문에 이제까지 썼던 방법으로 인자값 및 쉘코드를 전달할 수 없다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 476px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.2727272727272725%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAANElEQVR42h3Bxw3AMAwEsDzUfEWZJ/svFsDkgw8K6hVJWTNjCzhVteu51u7uiCR5LgCZ+QNTFgJqbLUzkQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/614058780ef653f69e69187ded16316d/c9b55/0.webp 165w,\n/static/614058780ef653f69e69187ded16316d/f2908/0.webp 330w,\n/static/614058780ef653f69e69187ded16316d/cf53a/0.webp 476w\"\n              sizes=\"(max-width: 476px) 100vw, 476px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/614058780ef653f69e69187ded16316d/04c57/0.png 165w,\n/static/614058780ef653f69e69187ded16316d/d9ecf/0.png 330w,\n/static/614058780ef653f69e69187ded16316d/f2205/0.png 476w\"\n            sizes=\"(max-width: 476px) 100vw, 476px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/614058780ef653f69e69187ded16316d/f2205/0.png\"\n            alt=\"goblin\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>입력값을 이미 넘겨 주었으나 입력값을 받기 위해 대기하고 있는 것을 볼 수 있다. 입력값이 위와 같은 방법으로는 넘어가지 않는 것을 확인하였다. 이번엔 파이프를 사용하여 값을 넘겨보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.696969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAUElEQVR42o3LMQ7AIAgAQBoTB0SwyoY0WP//x8Yf9PaDOc19mpk/3u8mIsy1MqkORMw5y8FEJK2VUlJKiKg6iAjWG2tFROy9VTvzufDDBfAB2HwF3NfmtwMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/69bc3cb18d6e4c2985afc223e5cd48fc/c9b55/1.webp 165w,\n/static/69bc3cb18d6e4c2985afc223e5cd48fc/f2908/1.webp 330w,\n/static/69bc3cb18d6e4c2985afc223e5cd48fc/9d6da/1.webp 492w\"\n              sizes=\"(max-width: 492px) 100vw, 492px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/69bc3cb18d6e4c2985afc223e5cd48fc/04c57/1.png 165w,\n/static/69bc3cb18d6e4c2985afc223e5cd48fc/d9ecf/1.png 330w,\n/static/69bc3cb18d6e4c2985afc223e5cd48fc/5c6e9/1.png 492w\"\n            sizes=\"(max-width: 492px) 100vw, 492px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/69bc3cb18d6e4c2985afc223e5cd48fc/5c6e9/1.png\"\n            alt=\"pipe\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이상 없이 완료된 것을 볼 수 있다. 아래는 gdb로 본 goblin의 어셈블리어이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 421px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.51515151515152%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB1ElEQVR42n2T626kMAxGE0iYASa3IVfbCdCOtu//hiug1W612n7/j3w+2WZt33NOKRcfPNVaSp7n+XEmxOCDt9ZWQmO0NkZKyf4OtUoV27paZ6nWnLPSinPGOcdKj8cs5PB6f7PWLE8nRP8Nrq0BlLauzlkkSjl57/u+55zlUm63QUixrQ2JPj5+xRiklIM8IoRgSAQISKS0AoSYYgih6zrGWExJqYeQct1WY+1RRqmnc8Zoa62xhlFtiICVtNbX5BDDMAyMsQLwdE4Ise3bwWh9uw3G6HEc/3TGr8m1tZxTTGkc74yxDDBNoxBiXVsu8Hq9K620UtM0Dqc7o9YACxKZozMe2imN9xtjLOX8mOdLewn+uSzamGVZDmXnTm0igBO29ugcow/hfsKA4MPSC7Hv+9M5pdRwG76vqlYkBKpGK6w1lxxivF/aBbTWQsp935Bo2zZj9LI4H/w0T+eqagMEQLJWU60pp3Rof8LW2b7vQ/Ba6xD8MEjOedd1nPPPyYBQEI1RQBRTLKVcsPfeOcd+CFVCgMPQaCCMMcaUplM7fJXn/Do5/i9ciRCpGnPsOedUoFzMcZ5Xt/+lbVuMIeacct7fjicJKaUcu66bHw8pxQ/wb9eZMM57ZAz4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d3b601772bad847d84a2666142333236/c9b55/2.webp 165w,\n/static/d3b601772bad847d84a2666142333236/f2908/2.webp 330w,\n/static/d3b601772bad847d84a2666142333236/ced8d/2.webp 421w\"\n              sizes=\"(max-width: 421px) 100vw, 421px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d3b601772bad847d84a2666142333236/04c57/2.png 165w,\n/static/d3b601772bad847d84a2666142333236/d9ecf/2.png 330w,\n/static/d3b601772bad847d84a2666142333236/092ed/2.png 421w\"\n            sizes=\"(max-width: 421px) 100vw, 421px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d3b601772bad847d84a2666142333236/092ed/2.png\"\n            alt=\"disas\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이전 문제에서 했던 것처럼 argument에 shellcode를 적재하여 공격을 시도하고자 하여, argument를 주었을 시 프로그램 내에 잘 적재가 되는지 확인해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvklEQVR42oWPyXLEIAxEhfGYRWIxBlETbPD8/0+mcJJz3qmr1N2SoI/OtaQj5ZK99ykl50g+wL/UWmMM+x5rZSLiWkvJ+emyaJ13SmsfvDFaqY0IrbWIuKlthkOMYc4MIvoQLFpjNBFprcUfyyIFgABYHoQQv5vHPb5aY2YfPFeO++6ck1LqWYFIKKdf4qPXdf6ChM47Ywz00a+7cykAUJjH536/689FV7/a2V6vdVPq6ufZLyIEgHa2PvqRj2836A2oUFNdBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ffb7a6a23d7bc106525f73fdcfada603/c9b55/3.webp 165w,\n/static/ffb7a6a23d7bc106525f73fdcfada603/f2908/3.webp 330w,\n/static/ffb7a6a23d7bc106525f73fdcfada603/ff4b8/3.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ffb7a6a23d7bc106525f73fdcfada603/04c57/3.png 165w,\n/static/ffb7a6a23d7bc106525f73fdcfada603/d9ecf/3.png 330w,\n/static/ffb7a6a23d7bc106525f73fdcfada603/32056/3.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ffb7a6a23d7bc106525f73fdcfada603/32056/3.png\"\n            alt=\"argument addr\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>(중략)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 605px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAqklEQVR42nXN0XLCIBAF0MvEUBOLthhg9wKL//+VjunUPPkBZw5smD1MSgYQ77H2pioAvkNgq6ycT/PsfW2tmy3rCueUtGG3nxtsjNZbShuA3xhFNZcCIIRAspQyTZP3XlSVPC9n55yIkAwh7Nh6yumNU85/WMkiB+YLLwe+XmHDuvW8g3+cjlnk47zjseMXiDGy1iLyxkqdppP/8my1W1svK+BExR7jvm1PY/YUkf90qQwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c5d5ccc6703af57920dc33d00a7e75b9/c9b55/4.webp 165w,\n/static/c5d5ccc6703af57920dc33d00a7e75b9/f2908/4.webp 330w,\n/static/c5d5ccc6703af57920dc33d00a7e75b9/a9b84/4.webp 605w\"\n              sizes=\"(max-width: 605px) 100vw, 605px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c5d5ccc6703af57920dc33d00a7e75b9/04c57/4.png 165w,\n/static/c5d5ccc6703af57920dc33d00a7e75b9/d9ecf/4.png 330w,\n/static/c5d5ccc6703af57920dc33d00a7e75b9/90cbd/4.png 605w\"\n            sizes=\"(max-width: 605px) 100vw, 605px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c5d5ccc6703af57920dc33d00a7e75b9/90cbd/4.png\"\n            alt=\"argument addr2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>argument가 잘 적재된 것을 볼 수 있다. 시작 주소는 0xbffffc08이다. 공격을 아래와 같이 진행하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.121212121212121%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAWklEQVR42h3FSQoEIQwAwICHSQTbgNkbb/7/jYNdlwIziwxVyYxnPh6+ZNVbosLM8am33N3Dzb0q997MfM4BUxWR9eE5RdYYA+lCvPdO1KnfqLWG+ENEAMjMP03yCETJSlubAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/831a689513e0ce8483340a8f83115faa/c9b55/5.webp 165w,\n/static/831a689513e0ce8483340a8f83115faa/f2908/5.webp 330w,\n/static/831a689513e0ce8483340a8f83115faa/7eb86/5.webp 642w\"\n              sizes=\"(max-width: 642px) 100vw, 642px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/831a689513e0ce8483340a8f83115faa/04c57/5.png 165w,\n/static/831a689513e0ce8483340a8f83115faa/d9ecf/5.png 330w,\n/static/831a689513e0ce8483340a8f83115faa/1bba8/5.png 642w\"\n            sizes=\"(max-width: 642px) 100vw, 642px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/831a689513e0ce8483340a8f83115faa/1bba8/5.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>공격이 성공하지 않았다. 원인은 gets함수가 받는 stdin을 파이프로 전달받는 과정에 있다. 위의 (python –c ‘print “\\x90” * 20 + “\\x10\\xfc\\xff\\xbf”’)를 그대로 stdin으로 넘겨준 후, 문자열 읽기를 끝내기 위해 stdin의 끝에 EOF를 달고 입력받는 것을 끝낼 것이다. 이런 과정이었다면 쉘은 실행되었으나 실행되자마자 종료되었을 것이다. 그래서 페이로드를 아래처럼 다시 작성하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.848484848484848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtUlEQVR42o3IYW7DIAyGYQdMsDGkS0QCmHTKAdb7X28iWvt7j/RJrw3btmrXfvZaS2tl33Mph7a233LOpRbtehxHrbWfZ9P2/H7mnF+vH1iWJUgQGYspMvPoEGKMEoSYJEqMkuIQRJxzIoKIvZ+wbtvsfQjsvWcOPEZ+nkfciDwR3RczExGllCza67pAtaWUEK0xBhHtn9GI9vPAN2utcw4AVBWatnVdH18PYwz8zzRNAFBK+QVsIQ0vTe3elQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8ddac051cdf269546cf594da596c126f/c9b55/6.webp 165w,\n/static/8ddac051cdf269546cf594da596c126f/f2908/6.webp 330w,\n/static/8ddac051cdf269546cf594da596c126f/7eb86/6.webp 642w\"\n              sizes=\"(max-width: 642px) 100vw, 642px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8ddac051cdf269546cf594da596c126f/04c57/6.png 165w,\n/static/8ddac051cdf269546cf594da596c126f/d9ecf/6.png 330w,\n/static/8ddac051cdf269546cf594da596c126f/1bba8/6.png 642w\"\n            sizes=\"(max-width: 642px) 100vw, 642px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8ddac051cdf269546cf594da596c126f/1bba8/6.png\"\n            alt=\"exploit2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>공격에 성공하였다. 리눅스 명령어에서 세미콜론은 한줄에 여러 개의 명령어를 주고자 할때 쓰인다. $ [첫번째 명령어];[두번째 명령어] 와 같이 입력했을 때, 첫번째 명령어에서 오류가 생겨도 두번째 명령어는 반드시 실행이 된다. 위의 페이로드는 쉘 실행 후 cat을 바로 실행시켜 종료되는 것을 막고자 하였다.</p>\n<p>my-pass: hackers proof</p>","categories":["writeup","wargame","pwnable"],"date":"February 05, 2016","description":"","id":"9b5bf1cd-0033-521f-a500-2a7715b7c4ae","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-03/","title":"LOB 3번 (cobolt -> goblin)","readingTime":{"text":"3 min read"}},"listingPagePath":"/blog"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}