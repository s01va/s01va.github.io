{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-09/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/b1458af82cada0da5462d2ac44e56c96/98851/0.png","srcSet":"/static/b1458af82cada0da5462d2ac44e56c96/4ec1c/0.png 150w,\n/static/b1458af82cada0da5462d2ac44e56c96/ca4aa/0.png 300w,\n/static/b1458af82cada0da5462d2ac44e56c96/98851/0.png 600w","sizes":"(min-width: 600px) 600px, 100vw"},"sources":[{"srcSet":"/static/b1458af82cada0da5462d2ac44e56c96/40ac4/0.webp 150w,\n/static/b1458af82cada0da5462d2ac44e56c96/9e761/0.webp 300w,\n/static/b1458af82cada0da5462d2ac44e56c96/2ea1b/0.webp 600w","type":"image/webp","sizes":"(min-width: 600px) 600px, 100vw"}]},"width":660,"height":400.40000000000003}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - vampire\r\n        - check 0xbfff\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token char\">'\\xbf'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stack is still your friend.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// here is changed!</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">46</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'\\xff'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"but it's not forever\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| buffer[40] |\r\n| Stack frame pointer |\r\n| Return address |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>이전 문제와는 다르게 argv[1][46]의 값도 체크하고 있다. 환경변수 영역을 초기화시키지 않아서 환경변수를 응용하는 방법을 떠올릴 수 있지만 \\xbfff0000 이상의 위치에 환경변수가 위치하고 있기 때문에 이는 사용할 수 없다. 그렇다고 argv[0]을 이용할 수도 없다. 이 또한 \\xbfff0000 이상의 위치에 있기 때문이다.\r\n주소지 \\xbfff0000 아래로 내려가는 한 가지 방법으로 스택을 키우는 것이 있다. buffer에 많은 수의 문자열을 넣어 스택을 낮은 주소지 쪽으로 키우는 것이다. gdb를 실행시켜 buffer에 팔만개의 바이트를 입력하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b1458af82cada0da5462d2ac44e56c96/0a47e/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.848484848484848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwklEQVR42n3OSZKDMAxAUREPki3LYPCEXQkr7n/FFOl9v/2v+nBdV60llwdzWNfonXv9LMsC/xtzppSOfW+tikhrreScUsqliIj33hjjnENrtdb0QP+jlAKJq4gwc4yRmUMIzF5EQgj6yehpHBmjlVKIaKwx2qDF5+u+78/703vLOY8xtm2NUcg57z0RWsS/f0IkclprAEAkJLLWwhizlJLSBgDHcbTe9n0HAA6hn72fHdEqrXvv53mKCADUWuecpeQvVHINVAT9SgIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b1458af82cada0da5462d2ac44e56c96/c9b55/0.webp 165w,\n/static/b1458af82cada0da5462d2ac44e56c96/f2908/0.webp 330w,\n/static/b1458af82cada0da5462d2ac44e56c96/e88ff/0.webp 600w\"\n              sizes=\"(max-width: 600px) 100vw, 600px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b1458af82cada0da5462d2ac44e56c96/04c57/0.png 165w,\n/static/b1458af82cada0da5462d2ac44e56c96/d9ecf/0.png 330w,\n/static/b1458af82cada0da5462d2ac44e56c96/0a47e/0.png 600w\"\n            sizes=\"(max-width: 600px) 100vw, 600px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b1458af82cada0da5462d2ac44e56c96/0a47e/0.png\"\n            alt=\"buffer argv\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>(중략)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 595px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c876359b584f933a4ff0f143787a10d7/3dd3e/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.87878787878788%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAZElEQVR42iXM0Q6DIAxG4f/CDQySUJfaWsAi7/+QZtu5/nJQSgHAzHNOH0PkABDXtV+X/wrhDcDMWm/jHkQEYNuyuyPnDGDfP6pymhF9XyHGWisfrCqvZQEgIqqnqP59Sqm39gD/rggFsj2oUgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c876359b584f933a4ff0f143787a10d7/c9b55/1.webp 165w,\n/static/c876359b584f933a4ff0f143787a10d7/f2908/1.webp 330w,\n/static/c876359b584f933a4ff0f143787a10d7/536c8/1.webp 595w\"\n              sizes=\"(max-width: 595px) 100vw, 595px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c876359b584f933a4ff0f143787a10d7/04c57/1.png 165w,\n/static/c876359b584f933a4ff0f143787a10d7/d9ecf/1.png 330w,\n/static/c876359b584f933a4ff0f143787a10d7/3dd3e/1.png 595w\"\n            sizes=\"(max-width: 595px) 100vw, 595px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c876359b584f933a4ff0f143787a10d7/3dd3e/1.png\"\n            alt=\"buffer argv2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>이쯤 되니 주소지가 \\xbffe ... 이 되는 것을 확인할 수 있다. 이를 이용하여 페이로드를 다음과 같이 입력하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 641px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ce2a573cdf69bea8810bac49a441c081/c7dcc/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.878787878787882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArUlEQVR42pXOWxLCIAwFUF4Vh0cgFgIttBX3v0gH3YCemWTu/UrYvm3HeV7XWWuhnIio9T7GaG0fr7kz5es6W+/PMWopOVPvrfV+HAd7INZa930rtZZSWmtE5JyNYXLOan33AP5DSiHmcM65EIIZY7TWi1LLcrstk1SK/agUAgBrjbUG5in3yS6EAOAf62qt9d7PGgARvzXi/IwhYkrJec8Z439iMcY1rVJJ9r83sFcOh401dOAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ce2a573cdf69bea8810bac49a441c081/c9b55/2.webp 165w,\n/static/ce2a573cdf69bea8810bac49a441c081/f2908/2.webp 330w,\n/static/ce2a573cdf69bea8810bac49a441c081/de042/2.webp 641w\"\n              sizes=\"(max-width: 641px) 100vw, 641px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ce2a573cdf69bea8810bac49a441c081/04c57/2.png 165w,\n/static/ce2a573cdf69bea8810bac49a441c081/d9ecf/2.png 330w,\n/static/ce2a573cdf69bea8810bac49a441c081/c7dcc/2.png 641w\"\n            sizes=\"(max-width: 641px) 100vw, 641px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ce2a573cdf69bea8810bac49a441c081/c7dcc/2.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: music world</p>","categories":["writeup","pwnable"],"date":"February 05, 2016","description":"","id":"e3787896-a006-59d6-a85d-7f0e0fcdcd66","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-09/","title":"LOB 9번 (troll -> vampire)","readingTime":{"text":"2 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}