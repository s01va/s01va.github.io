{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-08/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/b21235753cc2d07d8049f2f73241b522/81283/0.png","srcSet":"/static/b21235753cc2d07d8049f2f73241b522/921db/0.png 161w,\n/static/b21235753cc2d07d8049f2f73241b522/0dc75/0.png 321w,\n/static/b21235753cc2d07d8049f2f73241b522/81283/0.png 642w","sizes":"(min-width: 642px) 642px, 100vw"},"sources":[{"srcSet":"/static/b21235753cc2d07d8049f2f73241b522/e1eb6/0.webp 161w,\n/static/b21235753cc2d07d8049f2f73241b522/8fea6/0.webp 321w,\n/static/b21235753cc2d07d8049f2f73241b522/89380/0.webp 642w","type":"image/webp","sizes":"(min-width: 642px) 642px, 100vw"}]},"width":660,"height":399.9065420560747}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">﻿<span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - troll\r\n        - check argc + argv hunter\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n\r\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>environ<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// here is changed</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">!=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argc must be two!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// egghunter</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token char\">'\\xbf'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stack is still your friend.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// check the length of argument</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argument is too long!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// buffer hunter</span>\r\n        <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// one more!</span>\r\n        <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| i[4] |\r\n| buffer[40] |\r\n| Stack frame pointer |\r\n| Return Address |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>stack frame은 이전 문제와 동일하다. 단 argument를 강제하는 분기문이 생겨서 이전처럼 argument를 여러 개 생성하여 공격하는 방식이 통하지 않게 되었다.\r\n하지만 위의 코드는 argv[0] 값을 검사하지 않고 있다. 하드링크를 만들고 거기에 쉘코드를 적재하여 이를 호출해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b21235753cc2d07d8049f2f73241b522/1bba8/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA7ElEQVR42pWM227DIBBEF1gMJDZ2bFxgL66iVlXVqPn/z6ucP+g8HM15mAEVOY5DRHpvRMREvfdaKzOv69pPa3rotm3Ep5RSVLXW+vt8goqIsIioCPNZzi8VZtJDz8F515i5UycmZm69lVIejx9QfVdRIqq1EXGtdbmtwxCmKU9THoZorbMOrUXn0DpvLSJ6AChlhzl/T9M9588Y98uljeM9RrpeP2LoMVBKHEMLoYawp6QhvKUkMVZrl9a+II2MfvJ+QRwRR+9n7/Mw3LzP3s+IV2OsMe5FhBeNcQAwzwtsUuIlwH9ijAGAnPMfasMVNqT5gB8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b21235753cc2d07d8049f2f73241b522/c9b55/0.webp 165w,\n/static/b21235753cc2d07d8049f2f73241b522/f2908/0.webp 330w,\n/static/b21235753cc2d07d8049f2f73241b522/7eb86/0.webp 642w\"\n              sizes=\"(max-width: 642px) 100vw, 642px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b21235753cc2d07d8049f2f73241b522/04c57/0.png 165w,\n/static/b21235753cc2d07d8049f2f73241b522/d9ecf/0.png 330w,\n/static/b21235753cc2d07d8049f2f73241b522/1bba8/0.png 642w\"\n            sizes=\"(max-width: 642px) 100vw, 642px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b21235753cc2d07d8049f2f73241b522/1bba8/0.png\"\n            alt=\"mkdir\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>디렉토리 생성을 목적으로 하였기 때문에 일부러 \\x2f가 없는 쉘코드를 사용하였다. 그런데 위와 같이 생성한 디렉토리에 하드링크 생성이 되지 않기 때문에 동일한 길이의 이름을 가진 디렉토리를 생성한 후 이후에 이것의 이름을 바꾸기로 하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1268f61b6d88ab93af14388528df7ac9/1bba8/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.60606060606061%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtUlEQVR42k3MQZLCIBCF4YZkOlghNIFFiCZKSSMxZs4w3v9Ullpa89e3eZsHnDnnzMwxxsTpFOM0z4nTut2ut3X95zu3360s5e9+h3JdyrJwfn7E8zll5pwP04EsGSJjjKE3sr19c85prS+lwPF0HMeAiHVd9b0VQmitEREAlFJd1+1eNUrBJyEEAAzDAGEMzrsGG0Tc78eqrrx3bdsCgPd+midrLRE579E28kcKEFJKAAghPAB1zhQVMIggcgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1268f61b6d88ab93af14388528df7ac9/c9b55/1.webp 165w,\n/static/1268f61b6d88ab93af14388528df7ac9/f2908/1.webp 330w,\n/static/1268f61b6d88ab93af14388528df7ac9/7eb86/1.webp 642w\"\n              sizes=\"(max-width: 642px) 100vw, 642px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1268f61b6d88ab93af14388528df7ac9/04c57/1.png 165w,\n/static/1268f61b6d88ab93af14388528df7ac9/d9ecf/1.png 330w,\n/static/1268f61b6d88ab93af14388528df7ac9/1bba8/1.png 642w\"\n            sizes=\"(max-width: 642px) 100vw, 642px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1268f61b6d88ab93af14388528df7ac9/1bba8/1.png\"\n            alt=\"rename1\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 641px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ea33a24abf3932a5a1685aa98cea40d/c7dcc/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAfklEQVR42o3NwQ4CIQxF0VYESl+ZZARW1gX//5NmQDeuvKvTpMmjMYaZ1WqlFABmBqBIEclmSCldFFFVADFGBY7jkCxzThpjqCoz375thhD2eWGb+b4QQiCi1hrNOf3l7s9a62dWi60AiMiP15ellHrv5O7n48xZ6O+YeS+/ATySB93/ikKpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4ea33a24abf3932a5a1685aa98cea40d/c9b55/2.webp 165w,\n/static/4ea33a24abf3932a5a1685aa98cea40d/f2908/2.webp 330w,\n/static/4ea33a24abf3932a5a1685aa98cea40d/de042/2.webp 641w\"\n              sizes=\"(max-width: 641px) 100vw, 641px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4ea33a24abf3932a5a1685aa98cea40d/04c57/2.png 165w,\n/static/4ea33a24abf3932a5a1685aa98cea40d/d9ecf/2.png 330w,\n/static/4ea33a24abf3932a5a1685aa98cea40d/c7dcc/2.png 641w\"\n            sizes=\"(max-width: 641px) 100vw, 641px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4ea33a24abf3932a5a1685aa98cea40d/c7dcc/2.png\"\n            alt=\"rename2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>연속되는 Z(0x5a)가 시작되는, 즉 argv[0]의 시작 주소는 0xbffff9a8이다. 이 디렉토리의 이름을 쉘코드를 포함한 문자열로 바꾼 후 진입하여 위에서 구한 주소지를 응용해 페이로드를 다음과 같이 작성하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 642px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b21235753cc2d07d8049f2f73241b522/1bba8/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA7ElEQVR42pWM227DIBBEF1gMJDZ2bFxgL66iVlXVqPn/z6ucP+g8HM15mAEVOY5DRHpvRMREvfdaKzOv69pPa3rotm3Ep5RSVLXW+vt8goqIsIioCPNZzi8VZtJDz8F515i5UycmZm69lVIejx9QfVdRIqq1EXGtdbmtwxCmKU9THoZorbMOrUXn0DpvLSJ6AChlhzl/T9M9588Y98uljeM9RrpeP2LoMVBKHEMLoYawp6QhvKUkMVZrl9a+II2MfvJ+QRwRR+9n7/Mw3LzP3s+IV2OsMe5FhBeNcQAwzwtsUuIlwH9ijAGAnPMfasMVNqT5gB8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b21235753cc2d07d8049f2f73241b522/c9b55/0.webp 165w,\n/static/b21235753cc2d07d8049f2f73241b522/f2908/0.webp 330w,\n/static/b21235753cc2d07d8049f2f73241b522/7eb86/0.webp 642w\"\n              sizes=\"(max-width: 642px) 100vw, 642px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b21235753cc2d07d8049f2f73241b522/04c57/0.png 165w,\n/static/b21235753cc2d07d8049f2f73241b522/d9ecf/0.png 330w,\n/static/b21235753cc2d07d8049f2f73241b522/1bba8/0.png 642w\"\n            sizes=\"(max-width: 642px) 100vw, 642px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b21235753cc2d07d8049f2f73241b522/1bba8/0.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: aspirin</p>","categories":["writeup","wargame","pwnable"],"date":"February 05, 2016","description":"","id":"c65de08a-33ba-511d-bf9a-4246bf9f59c3","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-08/","title":"LOB 8번 (orge -> troll)","readingTime":{"text":"3 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}