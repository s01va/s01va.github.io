{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-05/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/8b4034f66a32c34bf72fb280f19f9f89/51b64/0.png","srcSet":"/static/8b4034f66a32c34bf72fb280f19f9f89/c02c1/0.png 160w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/6c845/0.png 320w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/51b64/0.png 640w","sizes":"(min-width: 640px) 640px, 100vw"},"sources":[{"srcSet":"/static/8b4034f66a32c34bf72fb280f19f9f89/4d75c/0.webp 160w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/0166a/0.webp 320w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/e3b90/0.webp 640w","type":"image/webp","sizes":"(min-width: 640px) 640px, 100vw"}]},"width":660,"height":400.125}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">﻿<span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - wolfman\r\n        - egghunter + buffer hunter\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n\r\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>environ<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// egghunter</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token char\">'\\xbf'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stack is still your friend.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// buffer hunter</span>\r\n        <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure</p>\n<p>| i[4] |\r\n| buffer[40] |\r\n| Stack Frame Pointer |\r\n| Return Address |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>environ을 memset시키는 부분이 있다. 환경변수를 이용한 공격은 할 수 없다. 공격을 위한 조건은 이전의 문제와 같으니 같은 방법으로 풀이해 보았다. argv[1]에 48바이트를 채우고, argv[2]에 100바이트를 채운 후 그 주소값을 확인하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b4034f66a32c34bf72fb280f19f9f89/6af66/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.848484848484848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAt0lEQVR42k2Qi27DMAhF8Ut2jFMcnGLTddn6/z85Je6kHiR0kXhcAa/Xr8h96GBmIqq1xhidc9bamaeYwAcxRvh6Ps/h0aULEQ0drfHeWq1VVW+3dd9brcTbGaVgSiljzstSCgIRretaSokx+n+C959njTH2XVhjjHPeWptSAlUVkXrBvCFmxLykxXtvLgBgzk63c8nb9nEc3z/HxhxCUB36eCAiANyvR5zeLt1HR8wARrrMnhDCH5JoDJg8QBIZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8b4034f66a32c34bf72fb280f19f9f89/c9b55/0.webp 165w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/f2908/0.webp 330w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/0ba47/0.webp 640w\"\n              sizes=\"(max-width: 640px) 100vw, 640px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8b4034f66a32c34bf72fb280f19f9f89/04c57/0.png 165w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/d9ecf/0.png 330w,\n/static/8b4034f66a32c34bf72fb280f19f9f89/6af66/0.png 640w\"\n            sizes=\"(max-width: 640px) 100vw, 640px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8b4034f66a32c34bf72fb280f19f9f89/6af66/0.png\"\n            alt=\"disas\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>(중략)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ce24373e4e31fa7c563176c8fc57f161/0a47e/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.54545454545455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABG0lEQVR42j2Q24rkMBBD9WCnA5tMbr6Vq8p2nHSz//+FS6Zh34QQ6Ei47/fn74coAaBM132XUgAs69rO1lodx9HaQUsptW7b+hvLrVUiAjNrkX3fAGz77r07jgPAn2kKMTrnjDXGWO9DCGGaJgCH8zGEbdtQamGRY98BOOeIUggBwDzPzJxiHAZrjM2ZRHhZfgDEmJjZe4/3533dN6UIIBH13krRL3a/en2wX9YOrdXr6t8OVe29Z87oV2/nGePTFmKstYgwgJ9laa2p6vgajLVatLX6oAKZ+Tzrc5OoaNHv5v3YmXNK6buZOVOm1zAYY2KK/7F98CzsnENtVVQf9bihlJIzAZjmWURYZBxfxlh+pKzr79tEquKO4x++cB/R0UlIaQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ce24373e4e31fa7c563176c8fc57f161/c9b55/1.webp 165w,\n/static/ce24373e4e31fa7c563176c8fc57f161/f2908/1.webp 330w,\n/static/ce24373e4e31fa7c563176c8fc57f161/e88ff/1.webp 600w\"\n              sizes=\"(max-width: 600px) 100vw, 600px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ce24373e4e31fa7c563176c8fc57f161/04c57/1.png 165w,\n/static/ce24373e4e31fa7c563176c8fc57f161/d9ecf/1.png 330w,\n/static/ce24373e4e31fa7c563176c8fc57f161/0a47e/1.png 600w\"\n            sizes=\"(max-width: 600px) 100vw, 600px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ce24373e4e31fa7c563176c8fc57f161/0a47e/1.png\"\n            alt=\"disas2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>argv[2]가 시작하는 주소지는 0xbffffc1c임을 알 수 있다. 이를 이용하여 다음과 같이 공격을 시도하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 643px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b9c3f8ad8696f1866bdecf7f12f63f5/b5bda/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.848484848484848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtklEQVR42o3LWY6EMAxFUWeUIDYVpeIQZ4B/9r/AamADfT6sJ1kXpMlxHMxc687MOecxZ0rfOede91rrmKO11nsvpYjUMUbvvdb9ui5I6cucmbk1EZHeW855WRYi2h70cM4h4ju01gDAzPCJMWCw1jrnvPfWWu+9MUZrrd+r32m0NkopY4y1FgBSSnCeZ2tSSkHCEMLyIKIQAm3buq74CBiI6H5thIje+zsWucsYI/ybUgoA/pIfaPwOuDlNIyQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7b9c3f8ad8696f1866bdecf7f12f63f5/c9b55/2.webp 165w,\n/static/7b9c3f8ad8696f1866bdecf7f12f63f5/f2908/2.webp 330w,\n/static/7b9c3f8ad8696f1866bdecf7f12f63f5/b1337/2.webp 643w\"\n              sizes=\"(max-width: 643px) 100vw, 643px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7b9c3f8ad8696f1866bdecf7f12f63f5/04c57/2.png 165w,\n/static/7b9c3f8ad8696f1866bdecf7f12f63f5/d9ecf/2.png 330w,\n/static/7b9c3f8ad8696f1866bdecf7f12f63f5/b5bda/2.png 643w\"\n            sizes=\"(max-width: 643px) 100vw, 643px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7b9c3f8ad8696f1866bdecf7f12f63f5/b5bda/2.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: love eyuna</p>","categories":["writeup","wargame","pwnable"],"date":"February 05, 2016","description":"","id":"d7d99992-ab84-5828-9789-59528dc58926","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-05/","title":"LOB 5번 (orc -> wolfman)","readingTime":{"text":"2 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}