{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-06/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/1efcf0bd14780775918766f3427cd59b/ab525/0.png","srcSet":"/static/1efcf0bd14780775918766f3427cd59b/921db/0.png 161w,\n/static/1efcf0bd14780775918766f3427cd59b/b52ce/0.png 322w,\n/static/1efcf0bd14780775918766f3427cd59b/ab525/0.png 643w","sizes":"(min-width: 643px) 643px, 100vw"},"sources":[{"srcSet":"/static/1efcf0bd14780775918766f3427cd59b/e1eb6/0.webp 161w,\n/static/1efcf0bd14780775918766f3427cd59b/19c5e/0.webp 322w,\n/static/1efcf0bd14780775918766f3427cd59b/5cdbd/0.webp 643w","type":"image/webp","sizes":"(min-width: 643px) 643px, 100vw"}]},"width":660,"height":400.31104199066874}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - darkelf\r\n        - egghunter + buffer hunter + check length of argv[1]\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n\r\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>environ<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// egghunter</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>environ<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token char\">'\\xbf'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stack is still your friend.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token comment\">// check the length of argument</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argument is too long!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// buffer hunter</span>\r\n        <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| i[4] |\r\n| buffer[40] |\r\n| Stack Frame Pointer |\r\n| Return address |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>이전 문제의 조건에 argv[1]의 크기를 한정하는 조건이 추가되었다. 이전 문제들을 풀이할 때에도 argv[1]의 크기는 딱 48바이트로 맞추었으므로 같은 방식으로 문제를 풀어도 문제되지 않을 것이다. argv[1]에 48바이트를, argv[2]에 100바이트를 넣어 이들의 주소지를 확인해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 643px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1efcf0bd14780775918766f3427cd59b/b5bda/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.878787878787882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA4UlEQVR42lWPSXLEMAwDtdDUSkrUanv+/89UNLmkDyheQADqvlfrMsbIORNTjNFaa4zRWn/1izkopdVB63P03ph57UlEY84xp7QmUmOM0qTWGkIYozNTqZWIEF2IwYIFALX22vd+nnvtzcw5Z2ZOKXEpzL+SUsqU4QIA8N5dAM45a49ZRJjZB99aq7WmFKtIjDGE4JxDxBCjBVD/+av9vs9ai0vpo3MpKSUfPCJe12/W2akAABHhvLDWIqJzeMyfd8xpjUk5vZ93rgWn09pz701ESqnW29pTRJRSRPk5eUbrHzzkDootrPTEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1efcf0bd14780775918766f3427cd59b/c9b55/0.webp 165w,\n/static/1efcf0bd14780775918766f3427cd59b/f2908/0.webp 330w,\n/static/1efcf0bd14780775918766f3427cd59b/b1337/0.webp 643w\"\n              sizes=\"(max-width: 643px) 100vw, 643px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1efcf0bd14780775918766f3427cd59b/04c57/0.png 165w,\n/static/1efcf0bd14780775918766f3427cd59b/d9ecf/0.png 330w,\n/static/1efcf0bd14780775918766f3427cd59b/b5bda/0.png 643w\"\n            sizes=\"(max-width: 643px) 100vw, 643px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1efcf0bd14780775918766f3427cd59b/b5bda/0.png\"\n            alt=\"argv addr\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>(중략)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 609px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0433ffcca40ecc7f01fb3ae1af6a3334/d0d8c/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.121212121212125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvklEQVR42n3Q3arDIBBG0SFKgoeGWNBWnR/H2vd/xhKTHHrVuV/sj4He39o05wwAMUapktMTALz3zIRYjDHO/SESEc3zbK1FImFe1xV6f7emZeAQAmJ5Ph4AsHlPiCmlaZoG3u/EiEy03m4D95ZGLYQgQjmno1xFSsnGTM45EVaty7JYa5lFtW7btuNXb/nCqoJYTlyFztm/8KuMWgix1r12YKmC/5hZ64XlC7erHGNU1bN8v4swEh4P4+/yhT/ObhvVIE/yRwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0433ffcca40ecc7f01fb3ae1af6a3334/c9b55/1.webp 165w,\n/static/0433ffcca40ecc7f01fb3ae1af6a3334/f2908/1.webp 330w,\n/static/0433ffcca40ecc7f01fb3ae1af6a3334/117a4/1.webp 609w\"\n              sizes=\"(max-width: 609px) 100vw, 609px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0433ffcca40ecc7f01fb3ae1af6a3334/04c57/1.png 165w,\n/static/0433ffcca40ecc7f01fb3ae1af6a3334/d9ecf/1.png 330w,\n/static/0433ffcca40ecc7f01fb3ae1af6a3334/d0d8c/1.png 609w\"\n            sizes=\"(max-width: 609px) 100vw, 609px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0433ffcca40ecc7f01fb3ae1af6a3334/d0d8c/1.png\"\n            alt=\"argv addr2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>argv[2]는 0xbffffb0c부터 위치하는 것을 확인할 수 있다. 이를 바탕으로 아래와 같이 공격을 진행하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 639px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e3cd286f0675947f7599a52d522fc31/738b8/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.575757575757578%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAo0lEQVR42jWO246DQAxDkSCgkDiZVluGbiE7XP7/GysYrR+sY/nBbs7jmOd537ff93uapvM8X6+fJWLfyuP5jFiXdck5l618lk8pJWKdcv6L2I+jMTMF3M3MADUAqp4SgFEE0JTca3079YQbmbkxwzAMRNS2bd/3RFS9xspE1HVdBfpvqaMmItLj2mFmqMq1BlVlZr0F2HjpeiEi5iYiPI7u/gU7NA3+KXswxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0e3cd286f0675947f7599a52d522fc31/c9b55/2.webp 165w,\n/static/0e3cd286f0675947f7599a52d522fc31/f2908/2.webp 330w,\n/static/0e3cd286f0675947f7599a52d522fc31/d95e5/2.webp 639w\"\n              sizes=\"(max-width: 639px) 100vw, 639px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0e3cd286f0675947f7599a52d522fc31/04c57/2.png 165w,\n/static/0e3cd286f0675947f7599a52d522fc31/d9ecf/2.png 330w,\n/static/0e3cd286f0675947f7599a52d522fc31/738b8/2.png 639w\"\n            sizes=\"(max-width: 639px) 100vw, 639px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0e3cd286f0675947f7599a52d522fc31/738b8/2.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 115px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4abe788c5f47a21450b072108865c3fa/e907b/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABa0lEQVR42j1O63KaQBQ+exZMDGPQClbAuOByFZZLElEEgZjUmU7f/306SNPv33c9B8IwWv5Y6ppuWlvP9yzLikMPANamZZmGpunPs5mm65qu6fpqtfq5NkzDMGDE5+1X29+6S9t1bdM2VXUs0j0AnNr+9tVXx8NCfT5d6qo+dx8fdX2u26ZpzgBACAGklABBpIgEESVJooij9zBVNG0JAOpcVZ6md5cOwXtgQJIVrh8wtrU3a+4GO86A0OOpUpXJ45OaZWkURSLPfdcZFv/XRqT5axQn5XuexKEQ6W7HAGC+WEg4XBZCcL7biywK3PGdb9zLiEjIoFJESvGuElmWx+nv1D8iy5ORS7JMKcLt95/++pln6V7Exduhrsq8eI2TeEJAUZdJKoTYi7w4HMpzfemufVme3t6P12trWGvww9jzvM3Gsh1ny+zAd03T5C5/lOnDVGHMdmzGHMcPAu5xh3PXczcvL77vzeezvxyrLuxqaUGaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4abe788c5f47a21450b072108865c3fa/72348/3.webp 115w\"\n              sizes=\"(max-width: 115px) 100vw, 115px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4abe788c5f47a21450b072108865c3fa/e907b/3.png 115w\"\n            sizes=\"(max-width: 115px) 100vw, 115px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4abe788c5f47a21450b072108865c3fa/e907b/3.png\"\n            alt=\"my-pass\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: kernel crashed</p>","categories":["writeup","pwnable"],"date":"February 05, 2016","description":"","id":"ebfd2ce8-aa25-54ae-9fa4-35f2cdfac8fb","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-06/","title":"LOB 6번 (wolfman -> darkelf)","readingTime":{"text":"2 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}