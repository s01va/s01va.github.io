{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-01/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/1efa9abc07578ed96648353152c742c0/cbade/0.png","srcSet":"/static/1efa9abc07578ed96648353152c742c0/699d3/0.png 85w,\n/static/1efa9abc07578ed96648353152c742c0/6ee12/0.png 171w,\n/static/1efa9abc07578ed96648353152c742c0/cbade/0.png 341w","sizes":"(min-width: 341px) 341px, 100vw"},"sources":[{"srcSet":"/static/1efa9abc07578ed96648353152c742c0/96d64/0.webp 85w,\n/static/1efa9abc07578ed96648353152c742c0/ceca6/0.webp 171w,\n/static/1efa9abc07578ed96648353152c742c0/fb9cf/0.webp 341w","type":"image/webp","sizes":"(min-width: 341px) 341px, 100vw"}]},"width":660,"height":400.64516129032256}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| buffer[256] |\r\n| Stack Frame Pointer[4] |\r\n| Return address[4] |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>쉘코드를 삽입하기 위해서 몇 가지 방법을 생각해 낼 수 있다.\r\n첫째, 변수 buffer를 활용한다. 입력값의 크기를 검사하지 않는 strcpy의 특성을 이용하여, buffer에 쉘코드를 넣고 buffer와 SFP를 넘치게 하여 return address에 쉘코드가 실행되는 buffer의 주소를 계산하여 삽입하는 계획을 세운다.\r\n실행파일 gremlin은 소유주가 gremlin이므로 gate인 사용자는 디버깅을 할 수 없다. gate 소유의 디렉토리를 생성한 후 gremlin을 복사해 온 후 디버깅을 진행하도록 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 341px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.484848484848484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA1ElEQVR42n3Nya7CMAyFYcdtaIvSdMpoOx1gwfu/IQrc3ZU46//oAxG+HlcmIsoszMKTtVKEmbx3MaXn8zGO1odwXocCUEopxKZpEBFY+DyPlHP+O5Ot50KUvXOb9/Nsl3VlESklxtB1nTHmvM5pNCD8lTMzSS14mmw59io7tzlnrS17Gc0dAKr2wRFRKQV0kBwccgghxBRjisPQJ6IiZIxZ1+Vb1/T/pte8vJZhGxpsWt1qrRGx1fqmNd4QBvi1GIMI+/CRY0wp3aucd+Z+6SH/Or8BGMQUVOGikeEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1efa9abc07578ed96648353152c742c0/c9b55/0.webp 165w,\n/static/1efa9abc07578ed96648353152c742c0/f2908/0.webp 330w,\n/static/1efa9abc07578ed96648353152c742c0/5af35/0.webp 341w\"\n              sizes=\"(max-width: 341px) 100vw, 341px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1efa9abc07578ed96648353152c742c0/04c57/0.png 165w,\n/static/1efa9abc07578ed96648353152c742c0/d9ecf/0.png 330w,\n/static/1efa9abc07578ed96648353152c742c0/4c0ad/0.png 341w\"\n            sizes=\"(max-width: 341px) 100vw, 341px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1efa9abc07578ed96648353152c742c0/4c0ad/0.png\"\n            alt=\"cp\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>gdb로 gremlin의 어셈블리어를 확인한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 430px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 155.75757575757575%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADfElEQVR42o1U246rOBBMMBiwsbk4gDHutk0yZ///D1dtyGjmSDuzKA8RotRdXZcbIHrwbt+dc253ZpoexmitxnGUUvC67pQyj0ff94yx25fnfr/fnh8f6zI/5hkAYkoIXgip+14pdf7Rve462SlF+IJ9Ax+vVwgIiMaYdKTNrlLKsixb0aYjaa0mY/7589F1UkpJgK/gmBIAYAjjOGFEa+1jnm+3W8W52939ftN9fxzJbluM2LbNN3CIEcAD4mQmQLDWzguBGWMYQs0rpTQirpv1fk8paq3uRVEU98/J3gOaxyOmaO26uY1XFWPM7a4o7krrlKKnj9y8LMsyD+MoRUvT03EgQohxMibEuK6r955zzhgLMUgplFKv1zPEiAhKqa6Tfa+LoiAwTUZae5wmQOK8e19VVVEUHrAsme77EMNq7b5vTVM3bdsKce59w5guztOEIWTwXuW1QwxCCNl1KUUhRNu2ZVVxzs+xBE7HAeARw2QMcd7sDp5zmowx1nV9cnb77r0TQgzDwDl/g59P4pyIc4wEBkReVWVVQQhFUei+pw8Ceu903/daf9WZDkY609q4rOvmXFWVrCyd9+e1EcH5PQQUQnLO7+/nU2cYpzFE4gwANLksEaHmXAj5fD2V6pTWSqlvJiHO6LNUU8xSOedOqRCx5rxT+ngeZn6M0zgM47rMutfzPEspLp1jSpfO1n7qjCEI0SqtX6+n1po0klL3NP/U8lo7xGiMAYBlXXfv+VtnzqvPaztnm6ZRFK+3SUJKHjxmcExx2zYPGcwYADDGOqUy2HvwwzDMD6O1NsYI0V5re/DjOJJU1oYYKjoYSylKKWntj5eUsmkaxliRH8boR/ZEhN0TONswezs77JPz8TxOb/cDdcMwjlerEGf0GTxknRe72dODgNg0tew6D35eli2/r+u6bupL55iyPUOYpjElCr1/29MDDENP2c6rlmX5d4el4/mWasqcN0Tg/Mpz9R3wN/i0ZyRvkz2zt+HknOP1IxhD9LAj4jiOGHJu35Hc4Tfwac9cgOMZyc9r5xV+A5+cDdkz2G0LAU+wp0r5hTM1CeWZaghWu55Ur4P9DA6ROOfSn84ycPt+TSaf/rw2NQkF45Grd7XUJHVO1f8AHwcGSAfpHN41lK9dIpH/WaoYl2VerXVuO460LMu6bcsyF0Uhpbyi9x/gfwHzpHHwsWoQHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f99e8607895cb4a03cdb7883735b2b1b/c9b55/1.webp 165w,\n/static/f99e8607895cb4a03cdb7883735b2b1b/f2908/1.webp 330w,\n/static/f99e8607895cb4a03cdb7883735b2b1b/866c5/1.webp 430w\"\n              sizes=\"(max-width: 430px) 100vw, 430px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f99e8607895cb4a03cdb7883735b2b1b/04c57/1.png 165w,\n/static/f99e8607895cb4a03cdb7883735b2b1b/d9ecf/1.png 330w,\n/static/f99e8607895cb4a03cdb7883735b2b1b/05ed2/1.png 430w\"\n            sizes=\"(max-width: 430px) 100vw, 430px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f99e8607895cb4a03cdb7883735b2b1b/05ed2/1.png\"\n            alt=\"gdb disas main\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>buffer에 값을 넣는 strcpy 이후인 main+59에 breadpoint를 걸어준 후, 임의의 입력값을 넣어 buffer의 시작 주소를 파악한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.151515151515156%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABF0lEQVR42oWO25KDIBBExzCAcjGiQgZEwJhk//8Pt8x+wJ6Hrn7oU9Vwvt9biiEEijTPzjlnrLl9gX/ZcnZumueZiKy1D6LwCMu6eL8qNWithRB/KaUchqHvB2MMIl7y5JwxxlqjtL7KaLXW1lqtFRecC4GIUsrbjTHGhBAMGee867pLLq2lLfngJzeFEMb7qJTq+172kl82Xruuwy9/DmMMERlj8DzP53lsOQOAD7619qAIAON4L7XWWqQUiHwve6nFGAMAOee878uywOvzef989n0HgBDC+TpjSgBwn1z5IqVEzltrx3FYa6+ztZbWvF9hr7WUQkQAMM9zznn1HgCMtRQjReKcM8SYYkpJKQUAFIlidNP0C4RiFwFM14DqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8d9a42a89fdeed3e5442059a0b922b16/c9b55/2.webp 165w,\n/static/8d9a42a89fdeed3e5442059a0b922b16/f2908/2.webp 330w,\n/static/8d9a42a89fdeed3e5442059a0b922b16/a64e8/2.webp 572w\"\n              sizes=\"(max-width: 572px) 100vw, 572px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8d9a42a89fdeed3e5442059a0b922b16/04c57/2.png 165w,\n/static/8d9a42a89fdeed3e5442059a0b922b16/d9ecf/2.png 330w,\n/static/8d9a42a89fdeed3e5442059a0b922b16/a805e/2.png 572w\"\n            sizes=\"(max-width: 572px) 100vw, 572px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8d9a42a89fdeed3e5442059a0b922b16/a805e/2.png\"\n            alt=\"buffer addr\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>buffer의 시작 주소가 0xbfff948임을 알 수 있다.\r\ngdb에서 나와 원본 gremlin 파일로 BOF를 발생시킨다. buffer와 SFP가 총 260bytes이므로 nop로 200bytes, 쉘코드로 25bytes, 나머지 35bytes를 nop로 채운다. 그리고 return address에 buffer에서 쉘코드가 위치하기 전의 nop slide의 아무 지점의 주소를 넣어준다. 여기에서는 0xbfff950을 little endian을 감안해 삽입하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.454545454545457%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABAElEQVR42nWIy26CQAAASTABdpflUd2lSUUt5SJN8WAaeWV57ALtRcUYwGja//+KRu+dTOYwkuM4hJDpA0qpaZqU0PuZTQkhAADTNHWMLduyLEsDwDAM27YhRL7vS1XN84KxgolGsJzlRc5rXgkuGlGURZqlSZamWRrFUZREcRLv4l2URNvPbfvVSN35NIxDfxn6Sz9ex9vv7fZz9/po+91mLCt5eegO++O+ErwSFa85K/LudJQ+NmG4CYP3YB2sX73VZCJL/0MocReuu3CdZyfchJL35i1XS0qp/WRPZzOMdU1TIUIQQl3XEUIQQWwYCCGMsaIoqqoCAGRZfpnP/wCkzi4aERoKyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/aade2fea6a62134a4b8b8a774acb6ffd/c9b55/3.webp 165w,\n/static/aade2fea6a62134a4b8b8a774acb6ffd/f2908/3.webp 330w,\n/static/aade2fea6a62134a4b8b8a774acb6ffd/ff4b8/3.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/aade2fea6a62134a4b8b8a774acb6ffd/04c57/3.png 165w,\n/static/aade2fea6a62134a4b8b8a774acb6ffd/d9ecf/3.png 330w,\n/static/aade2fea6a62134a4b8b8a774acb6ffd/32056/3.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/aade2fea6a62134a4b8b8a774acb6ffd/32056/3.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>쉘을 획득한 모습을 확인할 수 있고, euid가 gremlin인 것을 확인하여 권한을 성공적으로 상승시켰음을 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 145px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.10344827586207%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFElEQVR42n3NXU+DMBSA4XMKbA4KLftmrPS0gAtsc8Y4hISLqVH//z9apolmXuy9f/KCiMI4lsvlcjafG6MdxsR4IkXIwzDkXAgRSxHH8Ww6vRsO4V9t1/V913YvTdsc9hWg89S/frx1ap1onb1/ffZd07TN6dQvFnMAQMQrj4iMMW8wQGSu6wKAiCdShgHn3B/BjR4Oj/vtZlPtju0RAOvtjvuj2SI5Ns+22pJOEYB99/O8OnPfl1JGkYiiCBEd53J2Xc8P/CAIhIhunW1REKlE6bVKdZYiYr2rc5NRfl+WxvG8qq7IEFljLWVkbVn+4bworNGp0kRaqwum3OaWlKbJWABziyLPskwbWq0SIrtW6hefAYVsHTlGvo3UAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/88be9b8de754c5e0462a6d587e613061/aa41e/4.webp 145w\"\n              sizes=\"(max-width: 145px) 100vw, 145px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/88be9b8de754c5e0462a6d587e613061/0af15/4.png 145w\"\n            sizes=\"(max-width: 145px) 100vw, 145px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/88be9b8de754c5e0462a6d587e613061/0af15/4.png\"\n            alt=\"mypass\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>my-pass: hello bof world</p>\n<ul>\n<li>또 다른 방법 1: 인자를 활용한다.</li>\n</ul>\n<p>이는 프로그램이 인자의 개수를 검사하지 않기 때문에 가능하다. argv는 프로그램 시작과 동시에 가져오므로, gdb에서 main+3부분에 breakpoint를 걸고 python을 이용해 buffer, return address, argv[2]를 확인하기 위한 인자들을 입력한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.848484848484848%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAyElEQVR42j2P6W7EIBCDCUcSjkCAcsywYWn3/d+x3dLGP6xPo5Flk6/Xq9ZSAUIMzrnTn+u6MsaEEIJzSinnjFLK/kUZW5aFELJtGxmfI6UPQMCGKafn6DmnXHIp5eqXtRYBrLWnP1NKMYZccghRG33Yg1jn9n03xkgprT2kkowxzvmMX96iE26n9H2RUpJ2PQCq98F7H2PQWiutpJLit/z9ffNc9Fe7j3H1HmMQQgAiNlRKEUJKKdjQGD0ZEPTkWtujKaV+Ir4BnkEOBzGmYjEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2ae620ace2c610aa9b3472a78abf68e7/c9b55/5.webp 165w,\n/static/2ae620ace2c610aa9b3472a78abf68e7/f2908/5.webp 330w,\n/static/2ae620ace2c610aa9b3472a78abf68e7/ff4b8/5.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2ae620ace2c610aa9b3472a78abf68e7/04c57/5.png 165w,\n/static/2ae620ace2c610aa9b3472a78abf68e7/d9ecf/5.png 330w,\n/static/2ae620ace2c610aa9b3472a78abf68e7/32056/5.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2ae620ace2c610aa9b3472a78abf68e7/32056/5.png\"\n            alt=\"argv2 addr\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>(중략)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 599px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACGUlEQVR42l3SyXKcMBQF0NdtRLcDiElofBpB3Y4r2E7+/+MSQXkTVndD6Z4rwcfX5+ef34/ng1K65fz59bXve9/3iHbfP/Z954LPM3t/f98/dusspV3O+de+55xBG4PWzvMEAMM4cs7P3PxoFs6F4ISQl6pijEkpm6YBgHEapZTDMEBMMaQopQCAhXO0VhyZUorWIpq6ritCDKJ1jlIKAEIK6xxbFsiPnJ9viAYApJIhRGN0aTEMPoQQ/O12I6R23qUUy2kASuuUEhcCfPAhRSE4ALCFaWM4L7nrOm2M1uo8WSmFiF3XlYLLYizObAZ0tnRgDACmaRJSsqXkpmmElEpKQkhVVZxzrVXbtgAwz7NSapxGiGuKa9JaAQAXBSOVPM3WOWvx9m123lHaH2bpvFuK+fl4/nxDW8xKqRjj6R+GIcQY42Gua+d9WtNp1kandRVCgAs+pnSuzdhpXgCg7TpljDnN1f9mxMNsnbWlw2GeZ6X1OVjTtlKXr66LWcrz5/bcFS2Wmda8pW0rHY4LTOtqLRZz38dUvvv9XhHivF/XdRzHUlvrtCalFORn3h6PkgCklFvefHAA0PfDuq1b3u6vrxUhIYb8yNM0HWaz5ayNLrXRuQIoVzUbg+faTdtqYwxiXdcvL5VU6njY9Lu2LWv74Eti7Hq5Msasc0rJ6/VCO2rL88T7/ZXUNSJaa2lPL5fLsjBjzD/zX9DiQ4q/x6WbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a3596f6da1de19a3126babc2090fb6be/c9b55/6.webp 165w,\n/static/a3596f6da1de19a3126babc2090fb6be/f2908/6.webp 330w,\n/static/a3596f6da1de19a3126babc2090fb6be/6407c/6.webp 599w\"\n              sizes=\"(max-width: 599px) 100vw, 599px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a3596f6da1de19a3126babc2090fb6be/04c57/6.png 165w,\n/static/a3596f6da1de19a3126babc2090fb6be/d9ecf/6.png 330w,\n/static/a3596f6da1de19a3126babc2090fb6be/43142/6.png 599w\"\n            sizes=\"(max-width: 599px) 100vw, 599px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a3596f6da1de19a3126babc2090fb6be/43142/6.png\"\n            alt=\"argv2 addr2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>A(\\x41)이 들어간 곳이 buffer + SFP, B(\\x42)가 들어간 곳이 return address의 자리, 그리고 C(\\x43)가 들어간 곳으로 argv[2]의 시작 주소가 0xbffffc06임을 알 수 있다. 이제 이를 통해 exploit을 진행한다. argv[1]에는 쓰레기 값으로 260bytes를 채우고 return address 자리에 argv[2]의 어떤 부분을 주소로 입력한다. 그리고 argv[2]는 앞부분을 어느정도 nop으로 채워준 후 쉘코드를 로드한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.272727272727277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA9ElEQVR42j2MbWuDMBSFA8YU/aKB5F6N1ehAV6jadaibi9FCK3v5/z9o1LEeHg4P58MhAJAkCeccEACkBMAIOedSSqViIUWs4iiOETEIgpBzIYUQIgjDsixJ8VQ8yPNc53maZWmWZlpnWuv7ovOiUIkSUsr7uwSAkPPnw4E0p7Zpm79uX07TbO1ltovdmKfZmsmM5sPYab4sdrHGmmm2b+P718836Ye+H7qu77qh64f+ul7Xz/W23m6b2MXWTV1V1bE+jmY8v55VovbpHhDruiaIKITwPI8x5vv+brejLmX/cV1GKd3EZYw5lDqOw1xGCMEIfwHZPydIv3ZuLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/906b1d769bf3ff5524ca426dcad8d8df/c9b55/7.webp 165w,\n/static/906b1d769bf3ff5524ca426dcad8d8df/f2908/7.webp 330w,\n/static/906b1d769bf3ff5524ca426dcad8d8df/ff4b8/7.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/906b1d769bf3ff5524ca426dcad8d8df/04c57/7.png 165w,\n/static/906b1d769bf3ff5524ca426dcad8d8df/d9ecf/7.png 330w,\n/static/906b1d769bf3ff5524ca426dcad8d8df/32056/7.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/906b1d769bf3ff5524ca426dcad8d8df/32056/7.png\"\n            alt=\"exploit2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>권한상승에 성공하였음을 볼 수 있다.</p>\n<ul>\n<li>또 다른 방법 2: 환경변수 활용</li>\n</ul>\n<p>환경변수에 shellcode를 적재하고 return address에 이 환경변수의 주소지를 떨어뜨려 실행시키는 풀이도 가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.545454545454545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAbklEQVR42oWKwQ4EERAFaS6ikWFoWof9/6/cmGT3OnWoVF6eWmuJiExuRLVW5tE7jcfMQ0TuUohaH53oLK3Wct/zMNTaa3/2nJxzztflvY8xppQCogGjtQYDAHDi5xMntXLOIWIImB6stf+feuMLkFkI3caleW8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/43a8160f202a1ec2d99506838af16892/c9b55/8.webp 165w,\n/static/43a8160f202a1ec2d99506838af16892/f2908/8.webp 330w,\n/static/43a8160f202a1ec2d99506838af16892/ff4b8/8.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/43a8160f202a1ec2d99506838af16892/04c57/8.png 165w,\n/static/43a8160f202a1ec2d99506838af16892/d9ecf/8.png 330w,\n/static/43a8160f202a1ec2d99506838af16892/32056/8.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/43a8160f202a1ec2d99506838af16892/32056/8.png\"\n            alt=\"exploit3\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>shellcode를 환경변수에 적재시킨 모습이다. 이후 환경변수 shellcode가 어느 주소에 위치하는지 확인하는 코드를 작성하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 365px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.272727272727277%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAl0lEQVR42pXPSQ7CMAwFUIckbTxnaDeocCTufxxUhWGHxFt9WbL8Da13M6u1IiIzj313UxEGCAAQ3mb+TGAiJiQyM8SSc4a/iAoxu/sYfWybqJrZNrq5E1FBtLOIqGprbWav1VRel2YLdztu9+O49tFHb8yyLLlgUT0XSllVjQiJSVTLuqaUYHksUCFAiPGSTymm+P3qpycZzwhfttjKHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9a5bfdfbc4c7e43d0995841019e45b77/c9b55/9.webp 165w,\n/static/9a5bfdfbc4c7e43d0995841019e45b77/f2908/9.webp 330w,\n/static/9a5bfdfbc4c7e43d0995841019e45b77/25243/9.webp 365w\"\n              sizes=\"(max-width: 365px) 100vw, 365px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9a5bfdfbc4c7e43d0995841019e45b77/04c57/9.png 165w,\n/static/9a5bfdfbc4c7e43d0995841019e45b77/d9ecf/9.png 330w,\n/static/9a5bfdfbc4c7e43d0995841019e45b77/2e8d1/9.png 365w\"\n            sizes=\"(max-width: 365px) 100vw, 365px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9a5bfdfbc4c7e43d0995841019e45b77/2e8d1/9.png\"\n            alt=\"envaddr.c\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 380px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.60606060606061%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtElEQVR42lWLy5KDIBAACQYEGWCUx6AjPpLK///iVvaWPvWhW1BtnY9zP4morW1thPPMvFWivOSMaRy1A0DEXCr4r6Sy5Foma0U6cnnV+iZEXDdm5kI1LXNIYblSWEEMQikN3jvntNZSPrVC+RiEEAKPeXml8ikO3Ma8906NMMZIMd4BLwwpbHvnnUPw1hoplTFNSvWdeeP7et/nffTuQ7DGjKPxHiY7DfI5agMADrxS//UvfwV7DoqLGWiCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4153e1e98c44ff7464513d7fa805add0/c9b55/10.webp 165w,\n/static/4153e1e98c44ff7464513d7fa805add0/f2908/10.webp 330w,\n/static/4153e1e98c44ff7464513d7fa805add0/1cdb2/10.webp 380w\"\n              sizes=\"(max-width: 380px) 100vw, 380px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4153e1e98c44ff7464513d7fa805add0/04c57/10.png 165w,\n/static/4153e1e98c44ff7464513d7fa805add0/d9ecf/10.png 330w,\n/static/4153e1e98c44ff7464513d7fa805add0/3f520/10.png 380w\"\n            sizes=\"(max-width: 380px) 100vw, 380px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4153e1e98c44ff7464513d7fa805add0/3f520/10.png\"\n            alt=\"envaddr\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>환경변수 shellcode가 위치한 주소를 알아냈다. 이를 이용하여 공격을 진행하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.393939393939394%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAf0lEQVR42pXKUQ6DMAwD0KZ0kDp2y/hAo/c/6NQhDrD3kViWkyRqiiAAd+97922T5NMWEe5VElDXdZ3T1oIc40oSy6uY5eWRcy6l3PdunjfLZZlLM2utpc91jTH2vQMgGUBFDTICaqq1xgSJJN2dvxCB8zxT7/043gDMLP2D5BcKKwdgDJMmnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/66e993962389b3ba35e3a8a925524eab/c9b55/11.webp 165w,\n/static/66e993962389b3ba35e3a8a925524eab/f2908/11.webp 330w,\n/static/66e993962389b3ba35e3a8a925524eab/ff4b8/11.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/66e993962389b3ba35e3a8a925524eab/04c57/11.png 165w,\n/static/66e993962389b3ba35e3a8a925524eab/d9ecf/11.png 330w,\n/static/66e993962389b3ba35e3a8a925524eab/32056/11.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/66e993962389b3ba35e3a8a925524eab/32056/11.png\"\n            alt=\"exploit4\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>","categories":["writeup","wargame","pwnable"],"date":"February 05, 2016","description":"","id":"05e84bad-49dd-5a4e-88cc-6b409b36eaea","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-01/","title":"LOB 1번 (gate -> gremlin)","readingTime":{"text":"4 min read"}},"listingPagePath":"/blog"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}