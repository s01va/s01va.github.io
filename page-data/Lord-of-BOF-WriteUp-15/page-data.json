{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/Lord-of-BOF-WriteUp-15/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/c3ce028046fb9eb6c9e9f053d597907c/9d034/0.png","srcSet":"/static/c3ce028046fb9eb6c9e9f053d597907c/b4e5d/0.png 104w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/b1e80/0.png 208w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/9d034/0.png 415w","sizes":"(min-width: 415px) 415px, 100vw"},"sources":[{"srcSet":"/static/c3ce028046fb9eb6c9e9f053d597907c/99b09/0.webp 104w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/8c3d7/0.webp 208w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/76f47/0.webp 415w","type":"image/webp","sizes":"(min-width: 415px) 415px, 100vw"}]},"width":660,"height":400.7710843373494}}}},"body":"<p>source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/*\r\n        The Lord of the BOF : The Fellowship of the BOF\r\n        - assassin\r\n        - no stack, no RTL\r\n*/</span>\r\n\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\r\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\r\n\r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argc <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"argv error\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'\\xbf'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stack retbayed you!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">47</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'\\x40'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"library retbayed you, too!!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// buffer+sfp hunter</span>\r\n        <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">44</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Stack frame structure:</p>\n<p>| buffer[40] |\r\n| SFP |\r\n| RET |\r\n| argc |\r\n| argv |\r\n| environ |</p>\n<p>19번째 줄에서 스택 사용을 방지하고 있고, 25번째 줄에서 argv[1][47]의 값을 검사함으로써 라이브러리 사용을 막고 있고, 32번째 줄에서 buffer와 sfp를 모두 0으로 지워버리고 있다. 이번엔 RET sled라는 공격기법을 적용해 보았다.\r\nRET sled는 간단하다. 함수가 끝날 때 호출되는 ret에 ret 주소를 입력하면, 그 다음에 오는 주소로 리턴되는 원리를 사용한 것이다. 이전까지는 ret 자리에 shell의 주소를 입력했다면, 이번에는 ret 자리에 ret 주소를 쓰고 바로 뒤이어서 shell 주소를 입력하는 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 415px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3ce028046fb9eb6c9e9f053d597907c/73926/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwUlEQVR42nXOy46DMAyFYYdQAlOIE2I79/Ty/g9ZIXUxGmm+1b850oGUc6kl5WytTTkxM7FQCADgT89MSqnWOzPtx27WdT8ORLttGwBA6208RqkVnetjtFZZhJkAgCUFuqL2FqO83m/v3c/9btGuq7nGMaWck8RoEVNOIuKcP0+vABCRReZZa62nadJaq2mC3/oYz9ez9YHOtdFrLSTCdN1mZucQ/lJKqW/mUojCGQIxt96isEUspdxu82IWYxb43wceAA/MXSSl+QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c3ce028046fb9eb6c9e9f053d597907c/c9b55/0.webp 165w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/f2908/0.webp 330w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/1d89e/0.webp 415w\"\n              sizes=\"(max-width: 415px) 100vw, 415px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c3ce028046fb9eb6c9e9f053d597907c/04c57/0.png 165w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/d9ecf/0.png 330w,\n/static/c3ce028046fb9eb6c9e9f053d597907c/73926/0.png 415w\"\n            sizes=\"(max-width: 415px) 100vw, 415px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c3ce028046fb9eb6c9e9f053d597907c/73926/0.png\"\n            alt=\"disas\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>ret의 주소를 확인하였다. 0x0804851e이다. 여기에 breakpoint를 걸고 아래와 같이 입력하여 확인하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f20def5e5e9d15bcbb9dc45970e6e4f5/32056/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.72727272727273%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABG0lEQVR42nWPy5aDIBBEEYKAgry6iZpRxEST///CGTzZzl10Vy3uosj8mADiPE/jOIYYet2zG6OU0oZSxiijjNXaNA2l30wp5ZwTQkgIXik1DEZKMVz0uldKClGrMdpaa8wghOj6znlvnXXOBe+r7L03w4AJrbXeO0CwgzXGRACtddu2WmvOb1JJJaVSSlw4d8n7XrayfT7v4zzO83y/z7KXUspxvLayzfMDEadpyjmv67osS87r4zHf73cpJUmIiBBCAISUEkC9KaUQQogV7/0VIcYIEBHA2uG7eZpGxNoxoTF1ueo6KQVjrGka8g+c3+p7vvY155Zz69yyLj/LT9tyznnO6/7crbOEkHmetrKlhISQCJC3OuJP/gWJ9xjo0xn+nAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f20def5e5e9d15bcbb9dc45970e6e4f5/c9b55/1.webp 165w,\n/static/f20def5e5e9d15bcbb9dc45970e6e4f5/f2908/1.webp 330w,\n/static/f20def5e5e9d15bcbb9dc45970e6e4f5/ff4b8/1.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f20def5e5e9d15bcbb9dc45970e6e4f5/04c57/1.png 165w,\n/static/f20def5e5e9d15bcbb9dc45970e6e4f5/d9ecf/1.png 330w,\n/static/f20def5e5e9d15bcbb9dc45970e6e4f5/32056/1.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f20def5e5e9d15bcbb9dc45970e6e4f5/32056/1.png\"\n            alt=\"memory\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6fc21e1ad4baf611885417c2829e1516/32056/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.36363636363637%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABB0lEQVR42i3Q266EIAxA0Q5mNDLJqNyFlhY8//+NJ+i88bK7WqD1fv31EDwAxBhb7yEGALDWMlfEDAD7votILnlSatWauRLRsixwx1cI4YmpkrEGAIw1iHie5xNTpRCjeoH+aKqUzvP9fkO7euvdezfiFKWJMSN23rFIzr+YRZCKUi+tPyKMhPM8Q7+6iDjnHrn33wnGGmmMWEZ8HCKCWJRSWmtpXPlem3mMeTTvfa1k77X340As55kA4LtthJhSVEqt60qEueQhS5MhWwsAIYTWxPshH8aMuWXI27axcCn5jnXlSvWWx2vIx7jTOWa2xj5yrZTz+O3vdytYYkrTNOSCJaW4LPM/o/YfKHb9Gy4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6fc21e1ad4baf611885417c2829e1516/c9b55/2.webp 165w,\n/static/6fc21e1ad4baf611885417c2829e1516/f2908/2.webp 330w,\n/static/6fc21e1ad4baf611885417c2829e1516/ff4b8/2.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6fc21e1ad4baf611885417c2829e1516/04c57/2.png 165w,\n/static/6fc21e1ad4baf611885417c2829e1516/d9ecf/2.png 330w,\n/static/6fc21e1ad4baf611885417c2829e1516/32056/2.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6fc21e1ad4baf611885417c2829e1516/32056/2.png\"\n            alt=\"memory2\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>우선 ‘if(argv[1][47] == '\\xbf')’ 조건을 성공적으로 우회한 것을 볼 수 있다. buffer 영역은 memset되어서 활용하지 못하고, argv 영역은 사용할 수 있다. argv에서 B(\\x42)를 입력한 부분은 0xbffffc20 즈음으로 생각하고 아래와 같은 페이로드를 입력하였다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/efa532d0ff9fd9597be96b1f6941f2cf/32056/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.878787878787882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAtElEQVR42pWO247CMBBDA41AucyNoWkmBNqy//+Pq6A+I3FeLMuybFfr0ntf11e1uu97KfNN9f33XupSytxaK6U8n7219lrX3vs8381s2zYRcSxclmK1WjMza492EwHIgJhSAgQRRgBiIiIA8N6fTmfvvXPOxRhDiJfr4PKRI/jKNE1DqlViTinHzw4i5pxTSkSEiCyCAMOyIAKzIGGMUVVHf7xhDiG4XziW9a6qCoiH/6X8D4xPDngViwTwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/efa532d0ff9fd9597be96b1f6941f2cf/c9b55/3.webp 165w,\n/static/efa532d0ff9fd9597be96b1f6941f2cf/f2908/3.webp 330w,\n/static/efa532d0ff9fd9597be96b1f6941f2cf/ff4b8/3.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/efa532d0ff9fd9597be96b1f6941f2cf/04c57/3.png 165w,\n/static/efa532d0ff9fd9597be96b1f6941f2cf/d9ecf/3.png 330w,\n/static/efa532d0ff9fd9597be96b1f6941f2cf/32056/3.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/efa532d0ff9fd9597be96b1f6941f2cf/32056/3.png\"\n            alt=\"exploit\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>my-pass: pushing me away</p>","categories":["writeup","pwnable"],"date":"February 05, 2016","description":"","id":"9d9f6ac5-e118-57c6-822c-a7a3022cb71e","keywords":["lob"],"slug":"/Lord-of-BOF-WriteUp-15/","title":"LOB 15번 (giant -> assassin)","readingTime":{"text":"2 min read"}},"listingPagePath":"/blog/"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}