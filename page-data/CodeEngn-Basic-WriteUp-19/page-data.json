{"componentChunkName":"component---node-modules-gatsby-theme-portfolio-minimal-src-templates-article-index-tsx","path":"/CodeEngn-Basic-WriteUp-19/","result":{"pageContext":{"article":{"banner":{"alt":null,"caption":null,"src":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/eeb600d85c724b40e8a3c1424850790d/cd753/0.png","srcSet":"/static/eeb600d85c724b40e8a3c1424850790d/cec7e/0.png 59w,\n/static/eeb600d85c724b40e8a3c1424850790d/9d378/0.png 118w,\n/static/eeb600d85c724b40e8a3c1424850790d/cd753/0.png 235w","sizes":"(min-width: 235px) 235px, 100vw"},"sources":[{"srcSet":"/static/eeb600d85c724b40e8a3c1424850790d/4f211/0.webp 59w,\n/static/eeb600d85c724b40e8a3c1424850790d/f7248/0.webp 118w,\n/static/eeb600d85c724b40e8a3c1424850790d/6a9cd/0.webp 235w","type":"image/webp","sizes":"(min-width: 235px) 235px, 100vw"}]},"width":660,"height":398.8085106382979}}}},"body":"<p>이 프로그램은 몇 밀리세컨드 후에 종료 되는가</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 235px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.60606060606061%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB0ElEQVR42p2O3W/SUBjG+9/pHLjo4jYGLWVGKUT9p7w0Xho1c8arxUTDApRBv97T9vScUyic9nRiItDWAMYE3YXxlydvnid5v6TK8ZFaV5pPzlS5JldPG3XlrK6oiiyfnhw/OlSVWunenf29PyVXKw8OylK1ctJuac/bWltrvnjWUhW5rTVbWvPp40a1cqTUqvfLe+XSjkr7dxuqfPjwQLoe6AiBbVsAtmPbCIHjrA0AuK7rIvB/4W20Nhiv63A4kIQQRVHkeV78M9tmIYQUcz6NItt2LNP0XZ/ScBwy7OMwZFE0Y5QwxjD2CaGTcQgIMRZuVyRJIiVxHEUTwzBtyzJHBiCPUUICyigJCEUAOCAIwWhkYN8zDDNk4+3w+vJ/vJ39fptznmXZYrFY3s6iyJZFtsxXi2K1zFcbny2LIuecSxjjNE3jOE7+QiTJlMcm4UYws1kCk9Si6zgKZtNYBAGWsO8LITjn8S6cx/M0uULRpy7SHfLm4+XL128vPnd7pnfega47HVMsUUrn83mapje7pOnNj+/fdBxf9HDHph++XL96f3n+1ehY5N2VPwiS2ZhJer/veR4AoNtwAPUN6I4c3XKHgHXL7W0iuJ6u938CP89PT4RN3BMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/eeb600d85c724b40e8a3c1424850790d/c9b55/0.webp 165w,\n/static/eeb600d85c724b40e8a3c1424850790d/e572b/0.webp 235w\"\n              sizes=\"(max-width: 235px) 100vw, 235px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/eeb600d85c724b40e8a3c1424850790d/04c57/0.png 165w,\n/static/eeb600d85c724b40e8a3c1424850790d/6783b/0.png 235w\"\n            sizes=\"(max-width: 235px) 100vw, 235px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/eeb600d85c724b40e8a3c1424850790d/6783b/0.png\"\n            alt=\"crackme\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>다음과 같은 창이 뜨는 프로그램이다. 확인 버튼을 눌러도 종료되지만, 방치해 두어도 수 초 뒤에 저절로 종료되는 것을 볼 수 있었다. 이 프로그램을 PEiD로 분석해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 418px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.96969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB/ElEQVR42k2O2W6bQBSGeczWwSRppaqqKveqD9DXSoUXEjvFkTNglsHAwMwwS8w2Q1HuK9It38XRp//oLMaHr98Wi8Xi08cvi89Xl+b8YmaZM2v+Us3Z/OLtb7HM2bsryzJn19bcnL15f315ZZmGc7sFAKxX6816vVwul7btbDar1drZbJa2vdvuHMdZL1eOc2vb9mZqrbZ3d4fD4fvNjcEYH4ZBSimEkFJyxhmrCKGcC0qrKRGCcz4JZ5xzQqiU8nw+B8fAyPM8z3LGOCUkiSHGWGs9/vxPxXhRIMY5pZRxPo6jUqppWghjI47h0T+mWY5y9LDfQ5hordUrMCZhGGbZdCVJkorSuq6fns4eAEaaZlmalRgXqEggxIR0XaeU0n+hlEEIyxKjHPm+HwQBF6I+n33fn4bzLMcYU1qpvn9+ftZaD6/AJYYQ4hITQtLTqSyxHoamqcMgMKSUSqmu67TWfd83bdu1E13bNk3Tvnwx0fdKqXEch2Ho+34YhqJARhRGURTHUVSWZQJhluUFQmmanpKT5/lpmgLghWHoAUAIbbtu2ti2WmuEkJGl6eHwGAQBpRQh5AEPPAJMiJTCdd0wjIQQTV0DAOI4EUK0bRdHEcYEQmjsXXe32/64v9/vHyilRVEUCFFC/nhRMFb986qqyrJ0Xdf3/d12+wuaTB974NK4FAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/26aa27708129587dbf0b4c0056857709/c9b55/1.webp 165w,\n/static/26aa27708129587dbf0b4c0056857709/f2908/1.webp 330w,\n/static/26aa27708129587dbf0b4c0056857709/cd572/1.webp 418w\"\n              sizes=\"(max-width: 418px) 100vw, 418px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/26aa27708129587dbf0b4c0056857709/04c57/1.png 165w,\n/static/26aa27708129587dbf0b4c0056857709/d9ecf/1.png 330w,\n/static/26aa27708129587dbf0b4c0056857709/d7398/1.png 418w\"\n            sizes=\"(max-width: 418px) 100vw, 418px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/26aa27708129587dbf0b4c0056857709/d7398/1.png\"\n            alt=\"PEiD\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>UPX로 패킹되어 있었다. 패킹을 풀어주도록 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 592px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKElEQVR42lXOTW+CQBSF4QvcURnnAoN8VBhQakxKN7KtsfKlTZMW29R050Kr//83NLpqn8WbnN2B1/f9rnv73HUfXbdpqrap6nJdlc91dW1Tl5umrstlWz+tV8tqvdq29cu23TTV9/4LHNt2bEcIklL6fpDnebEo8of88aZYFJN0IgRKqQ0GjIg8z3elCwCHwwEsyxZEiGiRxTkfj6M0SaR041jdhWEQhK6URBZjfRKWbTu9Xk/XdQA4nU7AkI1Go8D3Pc+zrzecMAj7/UE2zYZ8eJsBoqFrV6CBpmmICADn8w9I6XqeR4JM0xRCIDLOOSKSIMaYYaBpmvCfYRgAcLlcYD6fZ9Pp7H6WZVkURYlKVBxHUaRipeI4TdNEKSEE/4OIAOB4PP4CEDEnBQRvaOwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e3627937768be23e055cd23cd1d0fd28/c9b55/2.webp 165w,\n/static/e3627937768be23e055cd23cd1d0fd28/f2908/2.webp 330w,\n/static/e3627937768be23e055cd23cd1d0fd28/0be55/2.webp 592w\"\n              sizes=\"(max-width: 592px) 100vw, 592px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e3627937768be23e055cd23cd1d0fd28/04c57/2.png 165w,\n/static/e3627937768be23e055cd23cd1d0fd28/d9ecf/2.png 330w,\n/static/e3627937768be23e055cd23cd1d0fd28/1b853/2.png 592w\"\n            sizes=\"(max-width: 592px) 100vw, 592px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e3627937768be23e055cd23cd1d0fd28/1b853/2.png\"\n            alt=\"unpack\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>패킹을 풀고 올리디버거로 열었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.72727272727273%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACyElEQVR42k3Ry27bRhSAYVaSRdqpZd0oUSI5Q845cx+SFi1RbrroCxRogKI2EqBogyDNqg1QpIsunFiJhFwKP0EL9FUL2TFQYBaz+fCfmeP9/c+/73Yfrq6u323fb97urje7zdvd7WV7f3ZvrrdvNtuPn262u/dXV9cfPt58+uvm9euNlyRj4AR5SslkNO71+0eEhOPx8Sg8ns/7hI6Gw8NWu0WzmdJZWSJJQuRJnIw9z/M4/qrtK2NfsfzFZPJ0HD4FeJHEz+bzX6Lo+XHvuR/81Ok8BnxZlH80zZ/WvZTydyF+Ozy89Bh7pMylto+r6kcG3xP63ar5WakLIS6MeRKG3/r+N53O14gX1j05P39WFJdCXHDxQxA89BDn2oKxWNcaeZpls/V5IQQxltW1Wn/lsmzaan0BkBaOO4dZFmnNKI32YwOAtk4bw4BNplEYTgAxjuMkIVnOUkK73W67fSC4NMYVRYkctbFxHO8xpURba4xBZNNoGoYhIKRpkiRxksSEpP1B3/d95LyqyqZZSimVVnlO77GxxhrG8jAMR6NhzvLJdDKP45SkJye9ru93u93boGqapVISABCh3Wp5wHJtrbZmsaiQA6GkWa8ER1sUZ8uz4XDgeV4QBIwx6+xyWSMwIWSWkbs352pftqenFQCjGTl/uHbWCCmLskQOWZYxBsaaonBNs9RaAWBRuk6nfYfNZ4xAb8tSCqWV1uqk1wsC/+joSAhRVuViUXEOWuuc5fsy4v63jTV3mNB0tToTgiujC2dns+jgoNNutxHBFUVVlYzlWhtK78Zm/ysDu8copDRGz6LoywcPgiCAfcPU9SkCk0qlafIZa2Otc3W94BwpJev1SmsllHaFc85meR7HsRDcWrNqlpyDFDLPsz1OSQqIyLnWKt3vN65OS0RAzo3RlJLBYNAf9AFACF7XFSImSSqk6B50/gP7n5PkCVuJwwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/510134c286bbf40bccfa5ed1a8d85e58/c9b55/3.webp 165w,\n/static/510134c286bbf40bccfa5ed1a8d85e58/f2908/3.webp 330w,\n/static/510134c286bbf40bccfa5ed1a8d85e58/48c21/3.webp 591w\"\n              sizes=\"(max-width: 591px) 100vw, 591px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/510134c286bbf40bccfa5ed1a8d85e58/04c57/3.png 165w,\n/static/510134c286bbf40bccfa5ed1a8d85e58/d9ecf/3.png 330w,\n/static/510134c286bbf40bccfa5ed1a8d85e58/e4c9a/3.png 591w\"\n            sizes=\"(max-width: 591px) 100vw, 591px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/510134c286bbf40bccfa5ed1a8d85e58/e4c9a/3.png\"\n            alt=\"func\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>내부 함수들만 모아 보았다. Sleep, timeGetTime, SetTimer 등의 시간과 관련된 듯 한 함수들이 보인다. DestroyWindow 함수도 찾을 수 있었다. timeGetTime 함수는 Sleep함수 호출 시 몇 밀리세컨드만큼 중지할 것인지를 리턴하는 함수라고 한다. 이 함수들에 중단점을 걸고 실행시켜 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 433px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.96969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGUlEQVR42n2PQUvDQBBG8zO1aRsUEX+Vpx71oCD0qCiIRWipIlob0k262Z2sZHenTYoxzUjSVrzo4/HxZm/reN225+577l637e5s7Wy6s12v43Y3tluHB97J8ZEjhND5Ks0ya421FrG2DvuzBhFNjdZaG6PTNEXE6fTdWVVVcXaaX/akNiBEzPl04kdRGARMCjGPOADMgiCOhVJKCAFJImNJREopJy/X+UVv2T8Hg+EsZCwMGeOc8zlPAJRSMY/nUfRZFGVZftWURVEQESTg5FlGROtqCxFttgmiqjmb/fVeBwA4SqkF1t/Ev7GIywXKDzP2xWA8uR+9vrDk6c13GGMAIP9FSJmA9EN+PZz0bx+vbgZ3Y/9h+PwN9BBhR0lFTp8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/18934354d0f230299fcd2636dcca2ae8/c9b55/4.webp 165w,\n/static/18934354d0f230299fcd2636dcca2ae8/f2908/4.webp 330w,\n/static/18934354d0f230299fcd2636dcca2ae8/aff3a/4.webp 433w\"\n              sizes=\"(max-width: 433px) 100vw, 433px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/18934354d0f230299fcd2636dcca2ae8/04c57/4.png 165w,\n/static/18934354d0f230299fcd2636dcca2ae8/d9ecf/4.png 330w,\n/static/18934354d0f230299fcd2636dcca2ae8/55fc0/4.png 433w\"\n            sizes=\"(max-width: 433px) 100vw, 433px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/18934354d0f230299fcd2636dcca2ae8/55fc0/4.png\"\n            alt=\"warning\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>다음과 같은 경고창이 뜨며 실행을 계속할 수 없었다. 디버거 안에서 실행시키지 않을 때에는 다음과 같은 현상이 없으므로 안티디버깅 기법이 걸려 있다고 판단했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.2727272727272725%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAARUlEQVR42mNQVslSV8vR0CrUNyjX0SmWl88yMio3M6tSUcnX1SvW0y/T0y8VFEiWkEgzMS4zMSm3sq7RUC8wMioVF08CAM2kD1Hux86DAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ae2f5a671d288197ee6e7a8e941b85c4/c9b55/5.webp 165w,\n/static/ae2f5a671d288197ee6e7a8e941b85c4/f2908/5.webp 330w,\n/static/ae2f5a671d288197ee6e7a8e941b85c4/ff4b8/5.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ae2f5a671d288197ee6e7a8e941b85c4/04c57/5.png 165w,\n/static/ae2f5a671d288197ee6e7a8e941b85c4/d9ecf/5.png 330w,\n/static/ae2f5a671d288197ee6e7a8e941b85c4/32056/5.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ae2f5a671d288197ee6e7a8e941b85c4/32056/5.png\"\n            alt=\"IsDebuggerPresent\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>다음과 같은 함수가 있음을 발견했다. 이 함수가 있는 곳에 중단점을 걸고 실행시켰더니 아까와 같은 경고창이 뜨지 않았다. 이제 이 함수를 우회하도록 하겠다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 579px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.75757575757576%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAqElEQVR42lXLMQ6CMBQAUCJtae2HUhCsUBONgaA4gIOasrIQwcQYr+Du5g0cvLTRzbc/qwnlJVvtyzIviqquq3KTHo7s9Q4LhSYj5GCMMKUO/kLEIYQQhDBjTGtt3QGeM3Vtmu489P2pa1tzG/Trke/WOkvGnDPGpPSBc9d1fSmFEAAQR5ExxvJUvNiW0yQJgkDPUw88oZlqQWjhL8XvAABQ6lj/bNv+ABTzEuR52QfPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dfcb24e7c85631b215f1573e10f82553/c9b55/6.webp 165w,\n/static/dfcb24e7c85631b215f1573e10f82553/f2908/6.webp 330w,\n/static/dfcb24e7c85631b215f1573e10f82553/0c108/6.webp 579w\"\n              sizes=\"(max-width: 579px) 100vw, 579px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dfcb24e7c85631b215f1573e10f82553/04c57/6.png 165w,\n/static/dfcb24e7c85631b215f1573e10f82553/d9ecf/6.png 330w,\n/static/dfcb24e7c85631b215f1573e10f82553/c08bc/6.png 579w\"\n            sizes=\"(max-width: 579px) 100vw, 579px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dfcb24e7c85631b215f1573e10f82553/c08bc/6.png\"\n            alt=\"TEST\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>IsDebuggerPresent함수를 지난 후, EAX값을 And연산을 하여 그 결과가 0이 아닐 시 Jump를 수행한다. 아래는 Jump해서 도달하는 곳이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.515151515151516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAa0lEQVR42mOwsDBzdHQwMTV1cXbQ0tHj1jeQspRQtlJWNFdUVFBUVFRUUFDQ0NTU19fT0dHR0tI2AANNTU1bW1sGSUlxJWUlMTFReVk5URlR5TgbThkuVi4WVjZWNhCCAkZGRgYYgLCFhYUBXcgNxi+6zygAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d0e97e8e40bdd439c22c499139c46e2e/c9b55/7.webp 165w,\n/static/d0e97e8e40bdd439c22c499139c46e2e/f2908/7.webp 330w,\n/static/d0e97e8e40bdd439c22c499139c46e2e/ff4b8/7.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d0e97e8e40bdd439c22c499139c46e2e/04c57/7.png 165w,\n/static/d0e97e8e40bdd439c22c499139c46e2e/d9ecf/7.png 330w,\n/static/d0e97e8e40bdd439c22c499139c46e2e/32056/7.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d0e97e8e40bdd439c22c499139c46e2e/32056/7.png\"\n            alt=\"after jump\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>위에서 보았던 경고 구문임을 확인할 수 있다. IsDebuggerPresent 함수에서 리턴하는 EAX값을 0으로 만드는 방법도 있으나 MOV EAX,0으로 코드패치를 하는 방법을 선택했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 381px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAy0lEQVR42l3EzWrCQBhG4TcxP2akA0l0MmOSiWYM+hFB0IUKahtQsJteQ+nOfXsvXbhx4dV4U4IbwcPDwbdKTpPqNDCJQ0FnXvTWo/7Hgr5qtfMWP53rjc8OjGtb1ygIIQEE63EQ/jN1ntLFmLHXWDgU2ER4l9hG2HbxSVhKrCJsbOyB46tQxLrUIitb7pvn2EPVazMfj0SUrOo0TmKZijwXruvgJSm6lRnk6bDthwFj1YTyLCtLo1TRNPr3j/ky4GPOp9ymFpgFPN0BbwwZKvDL7vkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/c9b55/8.webp 165w,\n/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/f2908/8.webp 330w,\n/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/25250/8.webp 381w\"\n              sizes=\"(max-width: 381px) 100vw, 381px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/04c57/8.png 165w,\n/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/d9ecf/8.png 330w,\n/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/2add2/8.png 381w\"\n            sizes=\"(max-width: 381px) 100vw, 381px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6c5a3d54a7ec5950f9b2c69ce4c55fb0/2add2/8.png\"\n            alt=\"codepatch\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>다음과 같이 코드패치를 하고 그대로 덤프를 뜬 파일로 디버깅을 진행한다. 전과 같은 안티디버깅은 일어나지 않았다. 이제 본래 하려고 했던 timeGetTime함수에 중단점들을 걸고 프로그램을 실행시켜 관찰해 보도록 하겠다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.06060606060606%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBklEQVR42iXOS28SURwF8D81jGCIqfIS5v26M3PndYEiU42iwfIor0rbnTFuXfoF3Ndad42RusC60hhrISxsNDGAduPCpC2NX6JGk7I2LWd9fjkH1j7vb/VGb3uj7d3h+72fve/H3eFRdzjujcbd0bg3Ou7v//40OPzw9dfOt4Pd4VF3cNgdHPT3fvS7X2Dz4aP1wt1yoVQulxr16mK5uLrSarWatdpis14tlYrzuezN+Vv3CoU7+dtLzbOG5+VsHbXf7cC/WnWC1BSyMXF0XWVZ1nZs0zIwNhRVvkhRABCJ0oqq8jxHUiSRuAbnefF6G/6WKhNBTGmO4Vgm1kVJdInrOJZtW7qhBQOBKUZIEwTeJSRJJ30zMwCwsfUGTorlU0l0FUvWNZ5jYvGYKAm8wLEcR9NJv98PAOFIUlERw9KWbcXj8enyersDJ43GqYWvm2mT2Koi0kzSwLqmK0hTREmgqDMci7PYNFVV8m7kWI6Z4uftDvypNCbISGsudl0TY0mSSSrtuK7tuoaBA4FL57dZFRmCIJBUhmFY8F0AgGevOvCk+PiBWEPyMrZahr7EMEXHWbGsZUmq83yForIAdji8gFBD4CuK0qAoD3xpALz28iPk76/KGY9k83M5T8eOomGSyWLblZEpIePylWgwNMtLJpnLYZuks97VaCI0GwkGQ083Nv8D5kKIPRo+QCwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4ad29eefef5de9d9f18744936a2ded4b/c9b55/9.webp 165w,\n/static/4ad29eefef5de9d9f18744936a2ded4b/f2908/9.webp 330w,\n/static/4ad29eefef5de9d9f18744936a2ded4b/ff4b8/9.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4ad29eefef5de9d9f18744936a2ded4b/04c57/9.png 165w,\n/static/4ad29eefef5de9d9f18744936a2ded4b/d9ecf/9.png 330w,\n/static/4ad29eefef5de9d9f18744936a2ded4b/32056/9.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4ad29eefef5de9d9f18744936a2ded4b/32056/9.png\"\n            alt=\"004193AA\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그대로 실행시켜 보니 다음과 같은 지점에서 멈추었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 602px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.424242424242426%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA0UlEQVR42kXLwU7DIBgA4B/oWtiA0gJd6kaxFNpli7dlyebSs8m8qNGLr+LDGw9m3/2Dn+C/W6+UDkNfC2le3sP1ea2U4KKUpZCcUkoZo7QAQLK0cYzObb33gnMYU99tQlU3u93UttvzyXeHtYkNdWxlOc0XCMG/DKCAOwSVqaW0QpZDdFoJfznH475zjW0qY9TmwdSac57TIgNAXChrpVIrxvK//vX5Mc+vWp/6cF0W09PbLc03offAPVo+YpwwSYSMGEeARMghW4yETBgngOEX8fMUMMdFO80AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8fc83b74a71192ce3703f4931eba973b/c9b55/10.webp 165w,\n/static/8fc83b74a71192ce3703f4931eba973b/f2908/10.webp 330w,\n/static/8fc83b74a71192ce3703f4931eba973b/ff4b8/10.webp 602w\"\n              sizes=\"(max-width: 602px) 100vw, 602px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8fc83b74a71192ce3703f4931eba973b/04c57/10.png 165w,\n/static/8fc83b74a71192ce3703f4931eba973b/d9ecf/10.png 330w,\n/static/8fc83b74a71192ce3703f4931eba973b/32056/10.png 602w\"\n            sizes=\"(max-width: 602px) 100vw, 602px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8fc83b74a71192ce3703f4931eba973b/32056/10.png\"\n            alt=\"timeGetTime\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>계속 실행시키면 다른 곳에서 멈추지 않고 창이 바로 떴다. 다른 곳은 참조하지 않는 것으로 판단했다. 리턴 값이 중요하니 함수 내부는 관찰하지 않았다. 444C3E에서 timeGetTime의 리턴값을 ESI에 넣고, 444C5F의 Sleep함수의 리턴값을 EAX에 넣어 이를 비교시킨다. 아래는 444C63의 JNB에서 분기하는 지점이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 393px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.878787878787882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRElEQVR42jXNy07CQBSA4dMz5dKkUErpZWbaofeWEpCgLyAsJBhY6UaNCRHR6MJLWKgxbvUZ1IXGFzUa/bb/4ocsWw827tTalSIfF9F1FN8iLhAPARaMj9Nkr997ytK1YDcETyrlVVk+LZeWinJeKi9BCNEpOlqdy7JcdIskiYPAb7e5WmeXZ/HuzLZDn+eO6HHda1iZ2Ux0kzY5Z4bRAN8XURwqioUouZ7rcmbbjk0tTWPzVVxMzVJLIgaACVAHaAE0AAj8odSJIl+pmkhIlGZ5nhDyHy9epMfnrWHa1BoAgBJKICEgIkq/YDweTSY7nOUAEIRBHIdhFA43B8JLRgfbvUnfYszkluWZBjV0qrmJS7nT1NVqFeDt9f3z42s2PwKAJE0Zo54Q3V6X8vz+wZruV9BSUUgYINqIbSQpwRoS+Bl/A6TnLGBjR7ZzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/761e22df5f38ac22bf55aa3926b9bb00/c9b55/11.webp 165w,\n/static/761e22df5f38ac22bf55aa3926b9bb00/f2908/11.webp 330w,\n/static/761e22df5f38ac22bf55aa3926b9bb00/8efa6/11.webp 393w\"\n              sizes=\"(max-width: 393px) 100vw, 393px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/761e22df5f38ac22bf55aa3926b9bb00/04c57/11.png 165w,\n/static/761e22df5f38ac22bf55aa3926b9bb00/d9ecf/11.png 330w,\n/static/761e22df5f38ac22bf55aa3926b9bb00/d72ec/11.png 393w\"\n            sizes=\"(max-width: 393px) 100vw, 393px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/761e22df5f38ac22bf55aa3926b9bb00/d72ec/11.png\"\n            alt=\"444D3A\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>444D3A에서 EAX의 값이 [EBX+4]의 값보다 크지 않으면 timeGetTime 함수를 한번 더 거치게 되어 있다. [EBX+4]의 주소값에 들어 있는 값은 2B70이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 208px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.81818181818182%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAqklEQVR42m3Myw6CMBBA0aJBgg8wtGCntLXMTEGqJkb//9+MMaz0LO7yCjBwDoHGqGQDxnBEqRpvNDE9ni9iHmO05uS8o+BxsAPSLc2218UmF4jD/XYF0NYZZ8E7GC8TE+22pVis16ssy8QvDcDMfW9UK521Bk5d1zrvZHOsqkNdV/WxLopcCJF9fLusGqkuKc3X+bArB8RAUWvZtYoppDQjhnGK+/1W/PMGIaASHaY39H8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8f3330937685204b1f2cc27dbd2be809/c9b55/12.webp 165w,\n/static/8f3330937685204b1f2cc27dbd2be809/b96c0/12.webp 208w\"\n              sizes=\"(max-width: 208px) 100vw, 208px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8f3330937685204b1f2cc27dbd2be809/04c57/12.png 165w,\n/static/8f3330937685204b1f2cc27dbd2be809/8f2fb/12.png 208w\"\n            sizes=\"(max-width: 208px) 100vw, 208px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8f3330937685204b1f2cc27dbd2be809/8f2fb/12.png\"\n            alt=\"10\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>2B70은 10진수로 11120이다. timeGetTime함수의 리턴값과 Sleep함수의 리턴값의 차가 이것을 넘지 않았을 시 계속 수행하는 것으로 보아 이 프로그램은 11120 밀리세컨드 뒤에 자동종료가 된다고 판단할 수 있다.</p>\n<p>정답: 11120</p>","categories":["writeup","wargame","reversing"],"date":"July 21, 2015","description":"","id":"4d48823d-719c-5d20-b216-4efb03647385","keywords":["codeengn-basic"],"slug":"/CodeEngn-Basic-WriteUp-19/","title":"CodeEngn Basic 19","readingTime":{"text":"4 min read"}},"listingPagePath":"/blog"}},"staticQueryHashes":["1094019748","460736852"],"slicesMap":{}}